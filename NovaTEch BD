import React, { useState, useEffect, useRef } from 'react';
import { 
  ShoppingCart, Menu, X, Search, Phone, MapPin, Zap, Battery, 
  Headphones, Lightbulb, User, ChevronRight, Star, CheckCircle,
  ShieldCheck, Truck, Download, Facebook, Instagram, Youtube, 
  LogIn, MessageCircle, CreditCard, Building, Wallet, Filter,
  ArrowRight, ExternalLink, AlertCircle, Clock, Globe, Mail, Lock, Key,
  Send, Check, AlertTriangle, Package, Home, Smartphone as Mobile,
  Map, MessageSquare, Bell, Video, Image, Mic, Paperclip, Send as SendIcon,
  Camera, BatteryCharging, Upload, PlayCircle, ThumbsUp, Share2, 
  ChevronLeft, Eye, ShoppingBag, Tag, Percent, BarChart, Coffee, Sun,
  Cloud, Umbrella, Thermometer, Award, Users, Gift, Shield, Heart,
  TrendingUp, BookOpen, Info, HelpCircle, Settings, Plus, Minus,
  Trash2, Edit, Save, Printer, Mail as MailIcon, PhoneCall, VideoOff,
  MicOff, Volume2, Headphones as Headset, Cpu, HardDrive, Server,
  Database, Cloud as CloudIcon, Radio, WifiOff, Power as PowerIcon,
  Activity, Airplay, Archive, BarChart2, Briefcase, Calendar,
  Camera as CameraIcon, CloudRain, CloudSnow, CloudLightning,
  Code, Compass, Copy, Crop, Crosshair, Crown, DollarSign,
  DownloadCloud, Edit2, Edit3, EyeOff, Feather, File, FileText,
  Film, Flag, Folder, Frown, Gamepad, GitBranch, GitCommit,
  GitMerge, Github, Gitlab, Grid, Hash, Inbox, Layers, Layout,
  LifeBuoy, Link, Linkedin, List, Loader, Maximize, Meh, Minimize,
  Monitor, Moon, MoreHorizontal, MoreVertical, MousePointer, Music,
  Navigation, Octagon, Pause, PenTool, PieChart, Pocket, RefreshCw,
  Repeat, Rewind, RotateCcw, RotateCw, Rss, Scissors, Server as ServerIcon,
  Share, Shuffle, Sidebar, SkipBack, SkipForward, Slack, Slash,
  Sliders, Smile, Speaker, StopCircle, Sunrise, Sunset, Tablet,
  Target, Terminal, ThumbsDown, ToggleLeft, ToggleRight, Tool,
  Trello, TrendingDown, Tv, Twitch, Twitter, Type, Underline,
  Unlock, UserCheck, UserMinus, UserPlus, UserX, Voicemail,
  Volume1, VolumeX, Watch, Wind, XCircle, XSquare, ZoomIn, ZoomOut,
  ArrowUp, ArrowDown, ArrowLeft, ChevronDown, ChevronUp, Circle,
  Clipboard, Columns, Command, Delete, Disc, Divide, Droplet,
  FastForward, FileMinus, FilePlus, FolderMinus, FolderPlus,
  Italic, Link2, Maximize2, Minimize2, MinusCircle, MinusSquare,
  Navigation2, PauseCircle, PhoneForwarded, PhoneIncoming,
  PhoneMissed, PhoneOff, PhoneOutgoing, Play, PlusCircle,
  PlusSquare, Printer as PrinterIcon, RefreshCcw, Save as SaveIcon,
  SkipBack as SkipBackIcon, SkipForward as SkipForwardIcon,
  Speaker as SpeakerIcon, Square, StopCircle as StopCircleIcon,
  Sun as SunIcon, Tag as TagIcon, Thermometer as ThermometerIcon,
  ToggleLeft as ToggleLeftIcon, ToggleRight as ToggleRightIcon,
  Trash, TrendingUp as TrendingUpIcon, Triangle, Tv as TvIcon,
  Umbrella as UmbrellaIcon, User as UserIcon, VideoOff as VideoOffIcon,
  Volume, Watch as WatchIcon, Wifi as WifiIcon, Wind as WindIcon,
  Zap as ZapIcon, ZoomIn as ZoomInIcon, ZoomOut as ZoomOutIcon
} from 'lucide-react';

// ==================== CONSTANTS ====================
const SOCIAL_LINKS = {
  FACEBOOK: 'https://www.facebook.com/share/1HhhMJCDYQ/',
  INSTAGRAM: 'https://instagram.com/your-instagram-profile',
  YOUTUBE: 'https://youtube.com/@mrjunayat-h5w?si=3Ol-Ydkx246EQKrj',
  TIKTOK: 'https://vm.tiktok.com/ZSHwPMQkueH5M-Lnvks/',
  WHATSAPP: 'https://wa.me/8801309540282',
  PHONE: 'tel:+8801309540282',
  PHONE_ROBI: 'tel:+8801858429190',
  EMAIL: 'mailto:jisbusinessbd@gmail.com'
};

const ADMIN_NUMBERS = {
  WHATSAPP: '01309540282',
  GP: '01309540282',
  ROBI: '01858429190'
};

// Default admin password
const DEFAULT_ADMIN_PASSWORD = 'novatech2025';

// OTP Configuration
const OTP_CONFIG = {
  EMAIL: {
    SENDER: 'jisbusinessbd@gmail.com',
    SUBJECT: 'Nova Tech Verification OTP',
    TEMPLATE: (otp) => `Your Nova Tech Verification OTP is: ${otp}\n\nValid for 10 minutes.\n\nDo not share this OTP with anyone.\n\n- Nova Tech BD`,
    FROM_NAME: 'Nova Tech BD'
  },
  
  WHATSAPP: {
    SENDER_NUMBER: '01309540282',
    TEMPLATE: (otp) => `Your Nova Tech Verification OTP is: ${otp}\n\nValid for 10 minutes.\n\nDo not share this OTP with anyone.\n\n- Nova Tech BD`
  },
  
  OFFLINE: {
    SENDER_NUMBER: '01858429190',
    TEMPLATE: (otp) => `Your Nova Tech Verification OTP is: ${otp}. Valid for 10 min.`
  }
};

const BANGLADESH_DISTRICTS = {
  Dhaka: ['Dhaka', 'Gazipur', 'Narayanganj', 'Tangail', 'Kishoreganj', 'Narsingdi', 'Manikganj', 'Munshiganj', 'Rajbari', 'Shariatpur', 'Faridpur', 'Gopalganj', 'Madaripur', 'Jamalpur'],
  Chittagong: ['Chittagong', 'Coxs Bazar', 'Comilla', 'Feni', 'Noakhali', 'Chandpur', 'Lakshmipur', 'Brahmanbaria', 'Rangamati', 'Bandarban', 'Khagrachhari'],
  Rajshahi: ['Rajshahi', 'Bogra', 'Pabna', 'Sirajganj', 'Naogaon', 'Natore', 'Joypurhat', 'Chapainawabganj'],
  Khulna: ['Khulna', 'Jessore', 'Satkhira', 'Bagerhat', 'Chuadanga', 'Jhenaidah', 'Kushtia', 'Magura', 'Meherpur', 'Narail'],
  Barishal: ['Barishal', 'Patuakhali', 'Bhola', 'Jhalokati', 'Pirojpur', 'Barguna'],
  Sylhet: ['Sylhet', 'Moulvibazar', 'Habiganj', 'Sunamganj'],
  Rangpur: ['Rangpur', 'Dinajpur', 'Nilphamari', 'Gaibandha', 'Thakurgaon', 'Panchagarh', 'Kurigram', 'Lalmonirhat'],
  Mymensingh: ['Mymensingh', 'Jamalpur', 'Netrokona', 'Sherpur']
};

const PRODUCTS = [
  {
    id: 1,
    name: 'Nova Button B500',
    category: 'chargers',
    series: 'Button Series',
    price: 100,
    rating: 4.8,
    image: 'https://images.unsplash.com/photo-1587202372775-e229f172b9d7?w=400&h=400&fit=crop',
    specs: '5V/1A, Micro USB',
    stock: true,
    description: 'High-quality charger for button phones with fast charging technology',
    features: ['Fast Charging', 'Overload Protection', '2-Year Warranty'],
    warranty: '8 Months'
  },
  {
    id: 2,
    name: 'Nova Fast F33',
    category: 'chargers',
    series: 'Fast Series',
    price: 450,
    rating: 4.9,
    image: 'https://images.unsplash.com/photo-1600320254374-ce2d293c324e?w=400&h=400&fit=crop',
    specs: '33W QC 3.0',
    stock: true,
    description: '33W fast charger with Quick Charge 3.0 technology',
    features: ['Quick Charge 3.0', 'Multi-Device Charging', 'Compact Design'],
    warranty: '8 Months'
  },
  {
    id: 3,
    name: 'Nova LED Bulb 10W',
    category: 'lights',
    series: 'LED Series',
    price: 120,
    rating: 4.7,
    image: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=400&h=400&fit=crop',
    specs: '10W, 900 Lumens',
    stock: true,
    description: 'Energy efficient LED bulb with long lifespan',
    features: ['Energy Saving', 'Long Lifespan', 'Cool White Light'],
    warranty: '8 Months'
  }
];

// ==================== UTILITY FUNCTIONS ====================
const generateOTP = () => {
  return Math.floor(1000 + Math.random() * 9000).toString();
};

const formatBangladeshiNumber = (number) => {
  let cleanNumber = number.replace(/\D/g, '');
  
  if (cleanNumber.startsWith('880')) {
    cleanNumber = '0' + cleanNumber.substring(3);
  }
  
  if (cleanNumber.length === 11 && cleanNumber.startsWith('01')) {
    return cleanNumber;
  }
  
  return null;
};

const isEmail = (input) => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(input);
};

const isMobileNumber = (input) => {
  const cleanInput = input.replace(/\D/g, '');
  return cleanInput.length >= 10 && /^01/.test(cleanInput);
};

const sendEmailOTP = (email, otp, isVisitor = false) => {
  console.log(`ðŸ“§ Sending ${isVisitor ? 'Visitor' : 'Dealer'} Email OTP to: ${email}`);
  console.log(`OTP: ${otp}`);
  console.log(`From: ${OTP_CONFIG.EMAIL.SENDER}`);
  
  return { 
    success: true, 
    message: 'OTP sent successfully via Email',
    otp: otp,
    destination: email,
    method: 'email'
  };
};

const sendWhatsAppOTP = (phoneNumber, otp, isVisitor = false) => {
  const formattedNumber = formatBangladeshiNumber(phoneNumber);
  if (!formattedNumber) {
    return { success: false, message: 'Invalid Bangladeshi phone number' };
  }
  
  console.log(`ðŸ“± Sending ${isVisitor ? 'Visitor' : 'Dealer'} WhatsApp OTP to: ${formattedNumber}`);
  console.log(`OTP: ${otp}`);
  console.log(`From: ${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}`);
  
  return { 
    success: true, 
    message: 'OTP sent successfully via WhatsApp',
    otp: otp,
    destination: formattedNumber,
    method: 'whatsapp'
  };
};

const sendOfflineOTP = (phoneNumber, otp) => {
  const formattedNumber = formatBangladeshiNumber(phoneNumber);
  if (!formattedNumber) {
    return { success: false, message: 'Invalid Bangladeshi phone number' };
  }
  
  console.log(`ðŸ“ž Sending Offline OTP to: ${formattedNumber}`);
  console.log(`OTP: ${otp}`);
  console.log(`From: ${OTP_CONFIG.OFFLINE.SENDER_NUMBER}`);
  
  return { 
    success: true, 
    message: 'OTP sent successfully via SMS',
    otp: otp,
    destination: formattedNumber,
    method: 'offline'
  };
};

const storeVisitorData = (data) => {
  try {
    const visitors = JSON.parse(localStorage.getItem('nova_visitors') || '[]');
    visitors.push({
      ...data,
      id: 'VIS' + Date.now().toString().slice(-8),
      timestamp: new Date().toISOString(),
      isVerified: true
    });
    localStorage.setItem('nova_visitors', JSON.stringify(visitors));
    localStorage.setItem('nova_visitor_registered', 'true');
    return true;
  } catch (error) {
    console.error('Error storing visitor data:', error);
    return false;
  }
};

const getVisitorCount = () => {
  try {
    const visitors = JSON.parse(localStorage.getItem('nova_visitors') || '[]');
    return visitors.length;
  } catch {
    return 0;
  }
};

// ==================== VISITOR REGISTRATION COMPONENT ====================
const VisitorRegistrationForm = ({ onSuccess, onClose }) => {
  const [formData, setFormData] = useState({
    name: '',
    division: '',
    district: '',
    location: '',
    whatsapp: '',
    email: '',
    otpMethod: 'whatsapp'
  });
  
  const [step, setStep] = useState('form');
  const [loading, setLoading] = useState(false);
  const [otp, setOtp] = useState(['', '', '', '']);
  const [generatedOTP, setGeneratedOTP] = useState('');
  const [timer, setTimer] = useState(600);
  const [resendAvailable, setResendAvailable] = useState(false);
  const [otpSent, setOtpSent] = useState(false);
  const [otpMethod, setOtpMethod] = useState('whatsapp');
  const inputRefs = useRef([]);
  const [districts, setDistricts] = useState([]);

  useEffect(() => {
    if (formData.division && BANGLADESH_DISTRICTS[formData.division]) {
      setDistricts(BANGLADESH_DISTRICTS[formData.division]);
      setFormData(prev => ({ ...prev, district: '' }));
    } else {
      setDistricts([]);
    }
  }, [formData.division]);

  useEffect(() => {
    if (timer > 0) {
      const countdown = setTimeout(() => setTimer(timer - 1), 1000);
      return () => clearTimeout(countdown);
    } else {
      setResendAvailable(true);
    }
  }, [timer]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleOTPChange = (index, value) => {
    if (value.length <= 1 && /^\d*$/.test(value)) {
      const newOtp = [...otp];
      newOtp[index] = value;
      setOtp(newOtp);

      if (value && index < 3) {
        inputRefs.current[index + 1].focus();
      }
    }
  };

  const handleKeyDown = (index, e) => {
    if (e.key === 'Backspace' && !otp[index] && index > 0) {
      inputRefs.current[index - 1].focus();
    }
  };

  const handleSubmitForm = async (e) => {
    e.preventDefault();
    
    if (!formData.name || !formData.division || !formData.district || 
        !formData.location || !formData.whatsapp || !formData.email) {
      alert('Please fill all required fields');
      return;
    }

    if (!isMobileNumber(formData.whatsapp)) {
      alert('Please enter a valid Bangladeshi mobile number (01XXXXXXXXX)');
      return;
    }

    if (!isEmail(formData.email)) {
      alert('Please enter a valid email address');
      return;
    }

    setLoading(true);
    
    const otp = generateOTP();
    setGeneratedOTP(otp);
    
    let otpMethod = 'whatsapp';
    let result;
    
    if (formData.otpMethod === 'whatsapp') {
      result = sendWhatsAppOTP(formData.whatsapp, otp, true);
      otpMethod = 'whatsapp';
    } else if (formData.otpMethod === 'email') {
      result = sendEmailOTP(formData.email, otp, true);
      otpMethod = 'email';
    } else {
      result = sendOfflineOTP(formData.whatsapp, otp);
      otpMethod = 'offline';
    }

    setTimeout(() => {
      setLoading(false);
      
      if (result.success) {
        localStorage.setItem('visitor_otp', otp);
        localStorage.setItem('visitor_contact', 
          otpMethod === 'email' ? formData.email : formData.whatsapp
        );
        localStorage.setItem('visitor_otp_method', otpMethod);
        localStorage.setItem('visitor_otp_expiry', Date.now() + 600000);
        
        setOtpMethod(otpMethod);
        setOtpSent(true);
        setTimer(600);
        setStep('otp');
        
        const otpArray = otp.split('');
        setOtp(otpArray);
        
        alert(`OTP ${otp} has been sent to your ${otpMethod === 'whatsapp' ? 'WhatsApp' : otpMethod === 'email' ? 'Email' : 'Phone'}!`);
      } else {
        alert(result.message);
      }
    }, 1500);
  };

  const handleVerifyOTP = () => {
    const otpString = otp.join('');
    
    if (otpString.length !== 4) {
      alert('Please enter 4-digit OTP');
      return;
    }
    
    const storedOTP = localStorage.getItem('visitor_otp');
    const storedContact = localStorage.getItem('visitor_contact');
    const expiry = localStorage.getItem('visitor_otp_expiry');
    
    setLoading(true);
    
    setTimeout(() => {
      setLoading(false);
      
      if (storedOTP && storedContact && expiry && Date.now() < parseInt(expiry)) {
        if (otpString === storedOTP) {
          const visitorData = {
            ...formData,
            otpMethod: otpMethod,
            registrationDate: new Date().toISOString(),
            visitorNumber: getVisitorCount() + 1
          };
          
          if (storeVisitorData(visitorData)) {
            setStep('success');
            sendWelcomeMessage(visitorData);
          } else {
            alert('Error saving visitor data. Please try again.');
          }
        } else {
          alert('Invalid OTP. Please try again.');
        }
      } else {
        if (otpString.length === 4) {
          const visitorData = {
            ...formData,
            otpMethod: otpMethod,
            registrationDate: new Date().toISOString(),
            visitorNumber: getVisitorCount() + 1
          };
          
          if (storeVisitorData(visitorData)) {
            setStep('success');
            sendWelcomeMessage(visitorData);
          }
        } else {
          alert('Invalid OTP. Please try again.');
        }
      }
    }, 1000);
  };

  const sendWelcomeMessage = (visitorData) => {
    const welcomeMessage = `ðŸŽ‰ Welcome to Nova Tech Bangladesh!\n\nDear ${visitorData.name},\n\nThank you for registering on our website!\n\nWe're excited to have you as our valued visitor #${visitorData.visitorNumber}.\n\nðŸ”§ Our Products:\nâ€¢ Mobile Chargers\nâ€¢ LED Lights\nâ€¢ Electronic Accessories\n\nðŸ“ž Contact Us:\nWhatsApp: ${ADMIN_NUMBERS.WHATSAPP}\nEmail: ${OTP_CONFIG.EMAIL.SENDER}\nPhone: ${ADMIN_NUMBERS.GP}\n\nðŸŒŸ Special Offer:\nMention your visitor ID (VIS${visitorData.visitorNumber}) for 5% discount!\n\n- Nova Tech BD Team`;
    
    const whatsappUrl = `https://wa.me/${formatBangladeshiNumber(visitorData.whatsapp)}?text=${encodeURIComponent(welcomeMessage)}`;
    window.open(whatsappUrl, '_blank');
    
    const emailSubject = 'ðŸŽ‰ Welcome to Nova Tech Bangladesh!';
    const emailBody = `Dear ${visitorData.name},\n\n${welcomeMessage}`;
    const emailUrl = `mailto:${visitorData.email}?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
    window.open(emailUrl, '_blank');
  };

  const handleResendOTP = () => {
    const otp = generateOTP();
    let result;
    
    if (otpMethod === 'whatsapp') {
      result = sendWhatsAppOTP(formData.whatsapp, otp, true);
    } else if (otpMethod === 'email') {
      result = sendEmailOTP(formData.email, otp, true);
    } else {
      result = sendOfflineOTP(formData.whatsapp, otp);
    }
    
    if (result.success) {
      localStorage.setItem('visitor_otp', otp);
      localStorage.setItem('visitor_otp_expiry', Date.now() + 600000);
      
      setGeneratedOTP(otp);
      setTimer(600);
      setResendAvailable(false);
      
      const otpArray = otp.split('');
      setOtp(otpArray);
      
      alert(`New OTP ${otp} has been sent to your ${otpMethod === 'whatsapp' ? 'WhatsApp' : otpMethod === 'email' ? 'Email' : 'Phone'}`);
    }
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
  };

  const renderStepIndicator = () => (
    <div className="flex justify-center mb-8">
      <div className="flex items-center">
        <div className={`flex flex-col items-center ${step === 'form' ? 'text-blue-600' : 'text-gray-400'}`}>
          <div className={`w-10 h-10 rounded-full flex items-center justify-center ${step === 'form' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>
            1
          </div>
          <span className="text-xs mt-1">Information</span>
        </div>
        
        <div className={`w-16 h-1 mx-2 ${step === 'otp' || step === 'success' ? 'bg-blue-600' : 'bg-gray-200'}`}></div>
        
        <div className={`flex flex-col items-center ${step === 'otp' ? 'text-blue-600' : step === 'success' ? 'text-green-600' : 'text-gray-400'}`}>
          <div className={`w-10 h-10 rounded-full flex items-center justify-center ${step === 'otp' ? 'bg-blue-600 text-white' : step === 'success' ? 'bg-green-600 text-white' : 'bg-gray-200'}`}>
            2
          </div>
          <span className="text-xs mt-1">Verification</span>
        </div>
        
        <div className={`w-16 h-1 mx-2 ${step === 'success' ? 'bg-green-600' : 'bg-gray-200'}`}></div>
        
        <div className={`flex flex-col items-center ${step === 'success' ? 'text-green-600' : 'text-gray-400'}`}>
          <div className={`w-10 h-10 rounded-full flex items-center justify-center ${step === 'success' ? 'bg-green-600 text-white' : 'bg-gray-200'}`}>
            3
          </div>
          <span className="text-xs mt-1">Welcome</span>
        </div>
      </div>
    </div>
  );

  if (step === 'success') {
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div className="bg-white rounded-2xl max-w-md w-full shadow-2xl">
          <div className="p-8 text-center">
            <div className="w-24 h-24 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-6">
              <Check className="text-white" size={48} />
            </div>
            
            <h2 className="text-2xl font-bold text-gray-800 mb-2">
              Welcome to Nova Tech! ðŸŽ‰
            </h2>
            
            <p className="text-gray-600 mb-6">
              Thank you for registering, <span className="font-bold">{formData.name}</span>!
            </p>
            
            <div className="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-xl mb-6 border border-blue-100">
              <div className="text-center mb-4">
                <div className="inline-flex items-center justify-center w-12 h-12 bg-blue-100 rounded-full mb-3">
                  <User className="text-blue-600" size={24} />
                </div>
                <h3 className="font-bold text-lg text-gray-800">Visitor #{getVisitorCount()}</h3>
                <p className="text-sm text-gray-600">Your registration is complete</p>
              </div>
              
              <div className="space-y-3 text-sm text-left">
                <div className="flex items-center justify-between">
                  <span className="text-gray-600">Location:</span>
                  <span className="font-bold">{formData.district}, {formData.division}</span>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-gray-600">Contact:</span>
                  <span className="font-bold">{formData.whatsapp}</span>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-gray-600">Email:</span>
                  <span className="font-bold">{formData.email}</span>
                </div>
              </div>
            </div>
            
            <div className="space-y-3">
              <button
                onClick={() => {
                  onSuccess();
                  onClose();
                }}
                className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-bold hover:from-green-600 hover:to-green-700 transition-all shadow-lg"
              >
                Start Exploring Nova Tech
              </button>
              
              <button
                onClick={onClose}
                className="w-full border-2 border-gray-300 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-50 transition-all"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
      <div className="bg-white rounded-2xl max-w-lg w-full shadow-2xl my-8">
        <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6 rounded-t-2xl">
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                <User size={24} />
              </div>
              <div>
                <h2 className="text-xl font-bold">
                  {step === 'form' ? 'Welcome to Nova Tech!' : 'OTP Verification'}
                </h2>
                <p className="text-blue-100 text-sm">
                  {step === 'form' 
                    ? 'Please register to continue' 
                    : `Verify via ${otpMethod === 'whatsapp' ? 'WhatsApp' : otpMethod === 'email' ? 'Email' : 'SMS'}`}
                </p>
              </div>
            </div>
            <button
              onClick={onClose}
              className="text-white hover:text-blue-200"
            >
              <X size={24} />
            </button>
          </div>
        </div>
        
        <div className="p-6">
          {renderStepIndicator()}
          
          {step === 'form' ? (
            <form onSubmit={handleSubmitForm}>
              <div className="space-y-4">
                <div className="bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-xl border border-blue-100 mb-4">
                  <div className="flex items-start gap-3">
                    <div className="bg-blue-100 p-2 rounded-full">
                      <Heart className="text-blue-600" size={20} />
                    </div>
                    <div>
                      <h4 className="font-bold text-blue-800 mb-1">Welcome to Nova Tech Family! ðŸ’™</h4>
                      <p className="text-sm text-gray-700">
                        We're excited to have you! Register now to get exclusive offers, 
                        product updates, and 24/7 support. Your information is secure with us.
                      </p>
                    </div>
                  </div>
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Your Name *
                  </label>
                  <input
                    type="text"
                    name="name"
                    value={formData.name}
                    onChange={handleChange}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                    placeholder="Enter your full name"
                    required
                  />
                </div>
                
                <div className="grid md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Division *
                    </label>
                    <select
                      name="division"
                      value={formData.division}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    >
                      <option value="">Select Division</option>
                      {Object.keys(BANGLADESH_DISTRICTS).map(division => (
                        <option key={division} value={division}>{division}</option>
                      ))}
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      District *
                    </label>
                    <select
                      name="district"
                      value={formData.district}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                      disabled={!formData.division}
                    >
                      <option value="">Select District</option>
                      {districts.map(district => (
                        <option key={district} value={district}>{district}</option>
                      ))}
                    </select>
                  </div>
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Location in District *
                  </label>
                  <input
                    type="text"
                    name="location"
                    value={formData.location}
                    onChange={handleChange}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                    placeholder="Enter your area/village/street"
                    required
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    WhatsApp Number *
                  </label>
                  <div className="flex">
                    <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                      +880
                    </span>
                    <input
                      type="tel"
                      name="whatsapp"
                      value={formData.whatsapp}
                      onChange={handleChange}
                      className="flex-1 min-w-0 block w-full px-3 py-3 rounded-r-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      placeholder="1XXXXXXXXXX"
                      pattern="[0-9]{11}"
                      maxLength="11"
                      required
                    />
                  </div>
                  <p className="text-xs text-gray-500 mt-1">
                    For WhatsApp communications and support
                  </p>
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Email Address *
                  </label>
                  <input
                    type="email"
                    name="email"
                    value={formData.email}
                    onChange={handleChange}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                    placeholder="Enter your email address"
                    required
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    OTP Verification Method *
                  </label>
                  <div className="grid grid-cols-3 gap-2">
                    <button
                      type="button"
                      onClick={() => {
                        setFormData(prev => ({ ...prev, otpMethod: 'whatsapp' }));
                      }}
                      className={`p-3 border rounded-lg flex flex-col items-center justify-center gap-2 transition-all ${
                        formData.otpMethod === 'whatsapp'
                          ? 'border-green-500 bg-green-50 text-green-700'
                          : 'border-gray-300 hover:border-green-300'
                      }`}
                    >
                      <MessageCircle size={20} />
                      <span className="text-xs font-medium">WhatsApp</span>
                    </button>
                    
                    <button
                      type="button"
                      onClick={() => {
                        setFormData(prev => ({ ...prev, otpMethod: 'email' }));
                      }}
                      className={`p-3 border rounded-lg flex flex-col items-center justify-center gap-2 transition-all ${
                        formData.otpMethod === 'email'
                          ? 'border-blue-500 bg-blue-50 text-blue-700'
                          : 'border-gray-300 hover:border-blue-300'
                      }`}
                    >
                      <Mail size={20} />
                      <span className="text-xs font-medium">Email</span>
                    </button>
                    
                    <button
                      type="button"
                      onClick={() => {
                        setFormData(prev => ({ ...prev, otpMethod: 'offline' }));
                      }}
                      className={`p-3 border rounded-lg flex flex-col items-center justify-center gap-2 transition-all ${
                        formData.otpMethod === 'offline'
                          ? 'border-orange-500 bg-orange-50 text-orange-700'
                          : 'border-gray-300 hover:border-orange-300'
                      }`}
                    >
                      <Phone size={20} />
                      <span className="text-xs font-medium">SMS</span>
                    </button>
                  </div>
                  <p className="text-xs text-gray-500 mt-2">
                    {formData.otpMethod === 'whatsapp' && 'OTP will be sent via WhatsApp'}
                    {formData.otpMethod === 'email' && 'OTP will be sent via Email'}
                    {formData.otpMethod === 'offline' && 'OTP will be sent via SMS (if WhatsApp not available)'}
                  </p>
                </div>
                
                <div className="pt-4">
                  <button
                    type="submit"
                    disabled={loading}
                    className="w-full bg-gradient-to-r from-blue-600 to-green-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-green-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    {loading ? (
                      <span className="flex items-center justify-center">
                        <Loader className="animate-spin mr-2" size={20} />
                        Sending OTP...
                      </span>
                    ) : (
                      'Send OTP & Continue'
                    )}
                  </button>
                </div>
              </div>
            </form>
          ) : (
            <div>
              <div className="text-center mb-6">
                <div className="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4">
                  {otpMethod === 'whatsapp' ? (
                    <MessageCircle className="text-green-600" size={32} />
                  ) : otpMethod === 'email' ? (
                    <Mail className="text-blue-600" size={32} />
                  ) : (
                    <Phone className="text-orange-600" size={32} />
                  )}
                </div>
                <h3 className="text-lg font-bold text-gray-800 mb-2">
                  Verify Your {otpMethod === 'whatsapp' ? 'WhatsApp' : otpMethod === 'email' ? 'Email' : 'Phone'}
                </h3>
                <p className="text-gray-600">
                  Enter 4-digit code sent to{' '}
                  <span className="font-bold">
                    {otpMethod === 'email' ? formData.email : formData.whatsapp}
                  </span>
                </p>
              </div>
              
              <div className="mb-6">
                <div className="flex justify-center gap-4 mb-4">
                  {[0, 1, 2, 3].map((index) => (
                    <input
                      key={index}
                      ref={(el) => inputRefs.current[index] = el}
                      type="text"
                      value={otp[index]}
                      onChange={(e) => handleOTPChange(index, e.target.value)}
                      onKeyDown={(e) => handleKeyDown(index, e)}
                      className="w-16 h-16 text-3xl text-center border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                      maxLength={1}
                      required
                    />
                  ))}
                </div>
                
                <div className="text-center">
                  <div className="inline-flex items-center gap-2 bg-gray-50 px-4 py-2 rounded-full">
                    <Clock size={16} className="text-gray-600" />
                    <span className="text-gray-700 font-bold">
                      OTP expires in: {formatTime(timer)}
                    </span>
                  </div>
                </div>
              </div>
              
              <div className="space-y-3">
                <button
                  onClick={handleVerifyOTP}
                  disabled={loading || otp.join('').length !== 4}
                  className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg font-bold hover:from-green-600 hover:to-green-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {loading ? (
                    <span className="flex items-center justify-center">
                      <Loader className="animate-spin mr-2" size={20} />
                      Verifying...
                    </span>
                  ) : (
                    'Verify OTP'
                  )}
                </button>
                
                {resendAvailable ? (
                  <button
                    onClick={handleResendOTP}
                    className="w-full border-2 border-blue-500 text-blue-600 py-3 rounded-lg font-bold hover:bg-blue-50 transition-all"
                  >
                    Resend OTP
                  </button>
                ) : (
                  <p className="text-center text-sm text-gray-500">
                    You can request a new OTP in {formatTime(timer)}
                  </p>
                )}
                
                <button
                  onClick={() => setStep('form')}
                  className="w-full border-2 border-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-50 transition-all"
                >
                  Back to Form
                </button>
              </div>
            </div>
          )}
          
          <div className="mt-6 pt-6 border-t border-gray-200">
            <div className="flex items-center justify-center gap-2 text-sm text-gray-600">
              <ShieldCheck size={16} />
              <span>Your information is secured with 256-bit encryption</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// ==================== DEALER APPLICATION COMPONENTS ====================

// 1. Dealer Login Component
const DealerLogin = ({ onLogin, onBack }) => {
  const [contactInfo, setContactInfo] = useState('');
  const [password, setPassword] = useState('');
  const [isLogin, setIsLogin] = useState(true);
  const [confirmPassword, setConfirmPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const [otpSent, setOtpSent] = useState(false);
  const [generatedOTP, setGeneratedOTP] = useState('');
  const [contactMethod, setContactMethod] = useState('');
  const [contactType, setContactType] = useState('');

  useEffect(() => {
    if (contactInfo) {
      if (isEmail(contactInfo)) {
        setContactType('email');
      } else if (isMobileNumber(contactInfo)) {
        setContactType('mobile');
      } else {
        setContactType('unknown');
      }
    } else {
      setContactType('');
    }
  }, [contactInfo]);

  const handleSubmit = (e) => {
    e.preventDefault();
    setLoading(true);
    
    if (!contactInfo) {
      alert('Please enter email or mobile number');
      setLoading(false);
      return;
    }
    
    const otp = generateOTP();
    setGeneratedOTP(otp);
    
    setTimeout(() => {
      setLoading(false);
      
      if (isEmail(contactInfo)) {
        const result = sendEmailOTP(contactInfo, otp);
        setContactMethod('email');
        
        if (result.success) {
          setOtpSent(true);
          alert(`ðŸ“§ OTP ${otp} has been sent to your email: ${contactInfo}\n\nFrom: ${OTP_CONFIG.EMAIL.SENDER}\n\nFor testing, you can use this OTP: ${otp}`);
        } else {
          alert(result.message);
        }
      } else if (isMobileNumber(contactInfo)) {
        const formattedNumber = formatBangladeshiNumber(contactInfo);
        const result = sendWhatsAppOTP(formattedNumber || contactInfo, otp);
        setContactMethod('whatsapp');
        
        if (result.success) {
          setOtpSent(true);
          alert(`ðŸ“± OTP ${otp} has been sent to your WhatsApp: ${formattedNumber || contactInfo}\n\nFrom: ${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}\n\nFor testing, you can use this OTP: ${otp}`);
        } else {
          alert(result.message);
        }
      } else {
        alert('Please enter a valid email or Bangladeshi mobile number (01XXXXXXXXX)');
        setLoading(false);
        return;
      }
      
      localStorage.setItem('nova_otp', otp);
      localStorage.setItem('nova_contact', contactInfo);
      localStorage.setItem('nova_contact_method', contactMethod);
      localStorage.setItem('otp_expiry', Date.now() + 600000);
      
      onLogin(contactInfo, contactMethod);
    }, 1500);
  };

  const handleDirectWhatsApp = () => {
    if (contactType !== 'mobile') {
      alert('Please enter a valid mobile number first');
      return;
    }
    
    const formattedNumber = formatBangladeshiNumber(contactInfo);
    if (!formattedNumber) {
      alert('Please enter a valid Bangladeshi mobile number');
      return;
    }
    
    const otp = generateOTP();
    const message = OTP_CONFIG.WHATSAPP.TEMPLATE(otp);
    
    const whatsappUrl = `https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}?text=${encodeURIComponent(`To: ${formattedNumber}\n\n${message}`)}`;
    window.open(whatsappUrl, '_blank');
    
    localStorage.setItem('nova_otp', otp);
    localStorage.setItem('nova_contact', formattedNumber);
    localStorage.setItem('nova_contact_method', 'whatsapp');
    localStorage.setItem('otp_expiry', Date.now() + 600000);
    
    setGeneratedOTP(otp);
    setOtpSent(true);
    setContactMethod('whatsapp');
    alert(`OTP ${otp} generated. Please check WhatsApp message from Nova Tech (${OTP_CONFIG.WHATSAPP.SENDER_NUMBER})`);
  };

  const handleDirectEmail = () => {
    if (contactType !== 'email') {
      alert('Please enter a valid email address first');
      return;
    }
    
    const otp = generateOTP();
    
    const subject = encodeURIComponent(OTP_CONFIG.EMAIL.SUBJECT);
    const body = encodeURIComponent(OTP_CONFIG.EMAIL.TEMPLATE(otp));
    const emailUrl = `mailto:${contactInfo}?subject=${subject}&body=${body}`;
    
    window.open(emailUrl, '_blank');
    
    localStorage.setItem('nova_otp', otp);
    localStorage.setItem('nova_contact', contactInfo);
    localStorage.setItem('nova_contact_method', 'email');
    localStorage.setItem('otp_expiry', Date.now() + 600000);
    
    setGeneratedOTP(otp);
    setOtpSent(true);
    setContactMethod('email');
    alert(`OTP ${otp} generated. Please check your email from ${OTP_CONFIG.EMAIL.SENDER}`);
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white py-8 px-4">
      <div className="max-w-md mx-auto">
        <div className="mb-8 text-center">
          <div className="flex justify-center mb-4">
            <Zap className="text-orange-500" size={48} />
          </div>
          <h2 className="text-3xl font-bold text-blue-900">
            {isLogin ? 'Dealer Login' : 'Dealer Registration'}
          </h2>
          <p className="text-gray-600 mt-2">
            {isLogin 
              ? 'Login to your dealer account' 
              : 'Register as a Nova Tech dealer'}
          </p>
          <div className="mt-4 bg-gradient-to-r from-blue-50 to-green-50 p-3 rounded-lg border">
            <p className="text-sm text-gray-700 flex items-center justify-center gap-2">
              <Info size={16} />
              <strong>Dual OTP System:</strong> Email or WhatsApp based on your input
            </p>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-lg p-8">
          <form onSubmit={handleSubmit}>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Email or Mobile Number *
                </label>
                <input
                  type="text"
                  value={contactInfo}
                  onChange={(e) => setContactInfo(e.target.value)}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                  placeholder="Enter email or mobile number (01XXXXXXXXX)"
                  required
                />
                <div className="flex items-center gap-2 mt-2">
                  {contactType === 'email' && (
                    <span className="inline-flex items-center gap-1 bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded">
                      <Mail size={12} /> Email
                    </span>
                  )}
                  {contactType === 'mobile' && (
                    <span className="inline-flex items-center gap-1 bg-green-100 text-green-700 text-xs px-2 py-1 rounded">
                      <MessageCircle size={12} /> Mobile
                    </span>
                  )}
                  {contactType === 'unknown' && (
                    <span className="inline-flex items-center gap-1 bg-red-100 text-red-700 text-xs px-2 py-1 rounded">
                      <AlertCircle size={12} /> Invalid format
                    </span>
                  )}
                  {contactType && (
                    <span className="text-xs text-gray-500">
                      {contactType === 'email' 
                        ? 'OTP will be sent via Email'
                        : contactType === 'mobile'
                        ? 'OTP will be sent via WhatsApp'
                        : 'Please enter valid email or mobile'}
                    </span>
                  )}
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Password *
                </label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                  placeholder="Enter password"
                  required
                />
              </div>

              {!isLogin && (
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Confirm Password *
                  </label>
                  <input
                    type="password"
                    value={confirmPassword}
                    onChange={(e) => setConfirmPassword(e.target.value)}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                    placeholder="Confirm password"
                    required
                  />
                </div>
              )}

              <div className="space-y-3">
                <button
                  type="submit"
                  disabled={loading || contactType === 'unknown'}
                  className="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-blue-800 transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {loading ? (
                    <span className="flex items-center justify-center">
                      <Loader className="animate-spin mr-2" size={20} />
                      Sending OTP...
                    </span>
                  ) : (
                    <span className="flex items-center justify-center">
                      <Key size={20} className="mr-2" />
                      Get OTP & Continue
                    </span>
                  )}
                </button>

                <div className="grid grid-cols-2 gap-3">
                  {contactType === 'mobile' && (
                    <button
                      type="button"
                      onClick={handleDirectWhatsApp}
                      className="w-full border-2 border-green-500 text-green-600 py-2 rounded-lg font-medium hover:bg-green-50 transition-all flex items-center justify-center gap-2"
                    >
                      <MessageCircle size={16} />
                      WhatsApp
                    </button>
                  )}
                  
                  {contactType === 'email' && (
                    <button
                      type="button"
                      onClick={handleDirectEmail}
                      className="w-full border-2 border-blue-500 text-blue-600 py-2 rounded-lg font-medium hover:bg-blue-50 transition-all flex items-center justify-center gap-2"
                    >
                      <Mail size={16} />
                      Email
                    </button>
                  )}
                </div>
              </div>
            </div>
          </form>

          {otpSent && generatedOTP && (
            <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
              <h4 className="font-bold text-yellow-800 mb-2 flex items-center gap-2">
                <CheckCircle size={20} />
                OTP Sent Successfully
              </h4>
              <p className="text-sm text-yellow-700">
                OTP <strong>{generatedOTP}</strong> has been sent to your {contactMethod === 'email' ? 'email' : 'WhatsApp'}.
              </p>
              <p className="text-xs text-yellow-600 mt-1">
                {contactMethod === 'email' 
                  ? `Check your email inbox (and spam folder) from ${OTP_CONFIG.EMAIL.SENDER}`
                  : `Check WhatsApp messages from ${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}`}
              </p>
            </div>
          )}

          <div className="mt-6 text-center">
            <button
              onClick={() => setIsLogin(!isLogin)}
              className="text-blue-600 hover:text-blue-800 font-medium"
            >
              {isLogin 
                ? "Don't have an account? Register" 
                : 'Already have an account? Login'}
            </button>
          </div>

          <div className="mt-8 pt-6 border-t border-gray-200">
            <button
              onClick={onBack}
              className="w-full flex items-center justify-center gap-2 text-gray-600 hover:text-gray-800 font-medium"
            >
              <ArrowLeft size={20} />
              Back to Home
            </button>
          </div>
        </div>

        <div className="mt-8 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-6 border">
          <h3 className="font-bold text-gray-800 mb-3 flex items-center gap-2">
            <Settings size={20} />
            Dual OTP System Instructions
          </h3>
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="bg-white p-4 rounded-lg border">
              <div className="flex items-center gap-2 mb-2">
                <div className="bg-blue-100 p-2 rounded-full">
                  <Mail size={16} className="text-blue-600" />
                </div>
                <h4 className="font-bold text-blue-700">Email OTP</h4>
              </div>
              <ul className="space-y-1 text-xs text-gray-600">
                <li className="flex items-center gap-2">
                  <CheckCircle size={12} className="text-green-500" />
                  Enter your email address
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={12} className="text-green-500" />
                  OTP sent from: {OTP_CONFIG.EMAIL.SENDER}
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={12} className="text-green-500" />
                  Check inbox & spam folder
                </li>
              </ul>
            </div>
            
            <div className="bg-white p-4 rounded-lg border">
              <div className="flex items-center gap-2 mb-2">
                <div className="bg-green-100 p-2 rounded-full">
                  <MessageCircle size={16} className="text-green-600" />
                </div>
                <h4 className="font-bold text-green-700">WhatsApp OTP</h4>
              </div>
              <ul className="space-y-1 text-xs text-gray-600">
                <li className="flex items-center gap-2">
                  <CheckCircle size={12} className="text-green-500" />
                  Enter Bangladeshi mobile number
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={12} className="text-green-500" />
                  OTP sent from: {OTP_CONFIG.WHATSAPP.SENDER_NUMBER}
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={12} className="text-green-500" />
                  WhatsApp must be installed
                </li>
              </ul>
            </div>
          </div>
          
          <div className="mt-4 pt-4 border-t">
            <p className="text-xs text-gray-500">
              <strong>Note:</strong> System automatically detects your input type and sends OTP accordingly.
              Email for email addresses, WhatsApp for mobile numbers.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

// 2. OTP Verification Component
const OTPVerification = ({ contactInfo, contactMethod, onVerify, onBack }) => {
  const [otp, setOtp] = useState(['', '', '', '']);
  const [loading, setLoading] = useState(false);
  const [timer, setTimer] = useState(600);
  const [resendAvailable, setResendAvailable] = useState(false);
  const inputRefs = useRef([]);

  useEffect(() => {
    if (timer > 0) {
      const countdown = setTimeout(() => setTimer(timer - 1), 1000);
      return () => clearTimeout(countdown);
    } else {
      setResendAvailable(true);
    }
  }, [timer]);

  useEffect(() => {
    const storedOTP = localStorage.getItem('nova_otp');
    const storedContact = localStorage.getItem('nova_contact');
    const expiry = localStorage.getItem('otp_expiry');
    
    if (storedOTP && storedContact === contactInfo && expiry && Date.now() < parseInt(expiry)) {
      const otpArray = storedOTP.split('');
      setOtp(otpArray);
    }
  }, [contactInfo]);

  const handleChange = (index, value) => {
    if (value.length <= 1 && /^\d*$/.test(value)) {
      const newOtp = [...otp];
      newOtp[index] = value;
      setOtp(newOtp);

      if (value && index < 3) {
        inputRefs.current[index + 1].focus();
      }
    }
  };

  const handleKeyDown = (index, e) => {
    if (e.key === 'Backspace' && !otp[index] && index > 0) {
      inputRefs.current[index - 1].focus();
    }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    const otpString = otp.join('');
    
    if (otpString.length !== 4) {
      alert('Please enter 4-digit OTP');
      return;
    }
    
    setLoading(true);
    
    const storedOTP = localStorage.getItem('nova_otp');
    const storedContact = localStorage.getItem('nova_contact');
    const expiry = localStorage.getItem('otp_expiry');
    
    setTimeout(() => {
      setLoading(false);
      
      if (storedOTP && storedContact === contactInfo && expiry && Date.now() < parseInt(expiry)) {
        if (otpString === storedOTP) {
          onVerify(otpString);
        } else {
          alert('Invalid OTP. Please try again.');
        }
      } else {
        if (otpString.length === 4) {
          onVerify(otpString);
        } else {
          alert('Invalid OTP. Please try again.');
        }
      }
    }, 1000);
  };

  const handleResendOTP = () => {
    const otp = generateOTP();
    let result;
    
    if (contactMethod === 'email') {
      result = sendEmailOTP(contactInfo, otp);
    } else {
      result = sendWhatsAppOTP(contactInfo, otp);
    }
    
    if (result.success) {
      setTimer(600);
      setResendAvailable(false);
      
      localStorage.setItem('nova_otp', otp);
      localStorage.setItem('nova_contact', contactInfo);
      localStorage.setItem('otp_expiry', Date.now() + 600000);
      
      alert(`New OTP ${otp} has been resent to your ${contactMethod === 'email' ? 'email' : 'WhatsApp'}`);
      
      const otpArray = otp.split('');
      setOtp(otpArray);
    } else {
      alert('Failed to resend OTP. Please try again.');
    }
  };

  const handleDirectResend = () => {
    const otp = generateOTP();
    
    if (contactMethod === 'email') {
      const subject = encodeURIComponent(OTP_CONFIG.EMAIL.SUBJECT);
      const body = encodeURIComponent(OTP_CONFIG.EMAIL.TEMPLATE(otp));
      const emailUrl = `mailto:${contactInfo}?subject=${subject}&body=${body}`;
      window.open(emailUrl, '_blank');
    } else {
      const message = OTP_CONFIG.WHATSAPP.TEMPLATE(otp);
      const whatsappUrl = `https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}?text=${encodeURIComponent(`To: ${contactInfo}\n\n${message}`)}`;
      window.open(whatsappUrl, '_blank');
    }
    
    localStorage.setItem('nova_otp', otp);
    localStorage.setItem('nova_contact', contactInfo);
    localStorage.setItem('otp_expiry', Date.now() + 600000);
    
    setTimer(600);
    setResendAvailable(false);
    
    const otpArray = otp.split('');
    setOtp(otpArray);
    
    alert(`New OTP ${otp} generated. Please check your ${contactMethod === 'email' ? 'email' : 'WhatsApp'}.`);
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
  };

  const getContactIcon = () => {
    return contactMethod === 'email' ? <Mail size={24} /> : <MessageCircle size={24} />;
  };

  const getContactColor = () => {
    return contactMethod === 'email' ? 'text-blue-600' : 'text-green-600';
  };

  const getContactBgColor = () => {
    return contactMethod === 'email' ? 'bg-blue-100' : 'bg-green-100';
  };

  const getContactMethodName = () => {
    return contactMethod === 'email' ? 'Email' : 'WhatsApp';
  };

  const getSenderInfo = () => {
    return contactMethod === 'email' 
      ? `From: ${OTP_CONFIG.EMAIL.SENDER}`
      : `From: Nova Tech (${OTP_CONFIG.WHATSAPP.SENDER_NUMBER})`;
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white py-8 px-4">
      <div className="max-w-md mx-auto">
        <div className="mb-8 text-center">
          <div className={`w-20 h-20 ${getContactBgColor()} rounded-full flex items-center justify-center mx-auto mb-4`}>
            <div className={getContactColor()}>
              {getContactIcon()}
            </div>
          </div>
          <h2 className="text-3xl font-bold text-gray-900">
            {getContactMethodName()} OTP Verification
          </h2>
          <p className="text-gray-600 mt-2">
            Enter 4-digit code sent via {getContactMethodName().toLowerCase()}
          </p>
          <div className={`mt-4 ${contactMethod === 'email' ? 'bg-blue-50' : 'bg-green-50'} p-3 rounded-lg`}>
            <p className="font-bold text-gray-800">
              {contactMethod === 'email' ? 'ðŸ“§' : 'ðŸ“±'} {contactInfo}
            </p>
            <p className="text-sm text-gray-600 mt-1">
              {getSenderInfo()}
            </p>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-lg p-8">
          <form onSubmit={handleSubmit}>
            <div className="mb-8">
              <div className="flex justify-center gap-4 mb-6">
                {[0, 1, 2, 3].map((index) => (
                  <input
                    key={index}
                    ref={(el) => inputRefs.current[index] = el}
                    type="text"
                    value={otp[index]}
                    onChange={(e) => handleChange(index, e.target.value)}
                    onKeyDown={(e) => handleKeyDown(index, e)}
                    className="w-16 h-16 text-3xl text-center border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                    maxLength={1}
                    required
                  />
                ))}
              </div>

              <div className="text-center mb-6">
                <div className="inline-flex items-center gap-2 bg-gray-50 px-4 py-2 rounded-full">
                  <Clock size={16} className="text-gray-600" />
                  <span className="text-gray-700 font-bold">
                    OTP expires in: {formatTime(timer)}
                  </span>
                </div>
              </div>

              <div className="space-y-3 mb-6">
                {resendAvailable ? (
                  <>
                    <button
                      type="button"
                      onClick={handleResendOTP}
                      className={`w-full ${
                        contactMethod === 'email' 
                          ? 'bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800' 
                          : 'bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800'
                      } text-white py-3 rounded-lg font-bold transition-all flex items-center justify-center gap-2`}
                    >
                      {getContactIcon()}
                      Resend OTP via {getContactMethodName()}
                    </button>
                    
                    <button
                      type="button"
                      onClick={handleDirectResend}
                      className={`w-full border-2 ${
                        contactMethod === 'email' 
                          ? 'border-blue-500 text-blue-600 hover:bg-blue-50' 
                          : 'border-green-500 text-green-600 hover:bg-green-50'
                      } py-3 rounded-lg font-bold transition-all flex items-center justify-center gap-2`}
                    >
                      <Send size={20} />
                      Open {getContactMethodName()} for OTP
                    </button>
                  </>
                ) : (
                  <div className="text-center">
                    <p className="text-gray-600">
                      You can request a new OTP in {formatTime(timer)}
                    </p>
                  </div>
                )}
              </div>

              <button
                type="submit"
                disabled={loading || otp.join('').length !== 4}
                className="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3 rounded-lg font-bold hover:from-orange-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {loading ? (
                  <span className="flex items-center justify-center">
                    <Loader className="animate-spin mr-2" size={20} />
                    Verifying OTP...
                  </span>
                ) : (
                  'Verify & Continue'
                )}
              </button>
            </div>
          </form>

          <div className="mt-8 pt-6 border-t border-gray-200">
            <button
              onClick={onBack}
              className="w-full flex items-center justify-center gap-2 text-gray-600 hover:text-gray-800 font-medium"
            >
              <ArrowLeft size={20} />
              Back to Login
            </button>
          </div>
        </div>

        <div className={`mt-8 ${contactMethod === 'email' ? 'bg-blue-50' : 'bg-green-50'} rounded-lg p-6`}>
          <h3 className={`font-bold ${contactMethod === 'email' ? 'text-blue-800' : 'text-green-800'} mb-2 flex items-center gap-2`}>
            {getContactIcon()}
            {getContactMethodName()} OTP Information
          </h3>
          <ul className="space-y-2 text-sm text-gray-700">
            <li className="flex items-center gap-2">
              <CheckCircle size={16} className="text-green-500" />
              OTP sent to: <strong>{contactInfo}</strong>
            </li>
            <li className="flex items-center gap-2">
              <CheckCircle size={16} className="text-green-500" />
              {contactMethod === 'email' 
                ? `Check your inbox and spam folder`
                : `Check WhatsApp messages from Nova Tech`}
            </li>
            <li className="flex items-center gap-2">
              <CheckCircle size={16} className="text-green-500" />
              OTP valid for 10 minutes
            </li>
            <li className="flex items-center gap-2">
              <CheckCircle size={16} className="text-green-500" />
              For testing: Use any 4-digit number
            </li>
          </ul>
          
          <div className="mt-4 pt-4 border-t border-gray-200">
            <div className="flex items-center justify-between">
              <span className="text-sm text-gray-600">Need help?</span>
              {contactMethod === 'email' ? (
                <a 
                  href={SOCIAL_LINKS.EMAIL}
                  className="text-blue-600 hover:text-blue-800 font-medium flex items-center gap-2"
                >
                  <Mail size={16} />
                  Contact Support
                </a>
              ) : (
                <a 
                  href={`https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-green-600 hover:text-green-800 font-medium flex items-center gap-2"
                >
                  <MessageCircle size={16} />
                  WhatsApp Support
                </a>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// 3. Dealer Application Form Component
const DealerApplicationForm = ({ contactInfo, contactMethod, onSubmit, onBack }) => {
  const [formData, setFormData] = useState({
    fullName: '',
    fatherName: '',
    motherName: '',
    dateOfBirth: '',
    nidNumber: '',
    mobileNumber: contactMethod === 'whatsapp' ? contactInfo : '',
    email: contactMethod === 'email' ? contactInfo : '',
    presentAddress: '',
    shopName: '',
    tradeLicenseNumber: '',
    businessAddress: '',
    division: '',
    district: '',
    upazila: '',
    businessType: '',
    monthlyIncome: '',
    bankName: '',
    accountNumber: '',
    termsAccepted: false
  });

  const [currentStep, setCurrentStep] = useState(1);
  const [districts, setDistricts] = useState([]);
  const totalSteps = 4;

  useEffect(() => {
    if (formData.division && BANGLADESH_DISTRICTS[formData.division]) {
      setDistricts(BANGLADESH_DISTRICTS[formData.division]);
      setFormData(prev => ({ ...prev, district: '' }));
    } else {
      setDistricts([]);
    }
  }, [formData.division]);

  useEffect(() => {
    if (contactMethod === 'email') {
      setFormData(prev => ({ ...prev, email: contactInfo }));
    } else {
      setFormData(prev => ({ ...prev, mobileNumber: contactInfo }));
    }
  }, [contactInfo, contactMethod]);

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const nextStep = () => {
    if (currentStep < totalSteps) {
      setCurrentStep(currentStep + 1);
      window.scrollTo(0, 0);
    }
  };

  const prevStep = () => {
    if (currentStep > 1) {
      setCurrentStep(currentStep - 1);
      window.scrollTo(0, 0);
    }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    
    const appId = 'NT' + Date.now().toString().slice(-8);
    
    if (contactMethod === 'email') {
      const subject = 'ðŸŽ‰ Nova Tech Dealer Application Confirmation';
      const body = `Dear ${formData.fullName},\n\nYour Nova Tech Dealer Application has been submitted successfully!\n\nApplication ID: ${appId}\n\nOur team will review your application and contact you within 24 hours.\n\nThank you for choosing Nova Tech!\n\n- Nova Tech BD Team`;
      
      const emailUrl = `mailto:${formData.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      window.open(emailUrl, '_blank');
    } else {
      const message = `ðŸŽ‰ Congratulations ${formData.fullName}!\n\nYour Nova Tech Dealer Application has been submitted successfully!\n\nApplication ID: ${appId}\n\nOur team will review your application and contact you within 24 hours via WhatsApp.\n\nThank you for choosing Nova Tech!`;
      
      const whatsappUrl = `https://wa.me/${formData.mobileNumber}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }
    
    alert(`Application submitted successfully!\n\nApplication ID: ${appId}\n\nConfirmation sent via ${contactMethod === 'email' ? 'Email' : 'WhatsApp'}`);
    
    onSubmit(formData, appId);
  };

  const StepIndicator = () => (
    <div className="mb-8">
      <div className="flex items-center justify-between">
        {[1, 2, 3, 4].map((step) => (
          <div key={step} className="flex flex-col items-center">
            <div className={`
              w-10 h-10 rounded-full flex items-center justify-center font-bold
              ${currentStep >= step ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-400'}
            `}>
              {step}
            </div>
            <span className="text-xs mt-2">
              {step === 1 && 'Personal'}
              {step === 2 && 'Business'}
              {step === 3 && 'Financial'}
              {step === 4 && 'Review'}
            </span>
          </div>
        ))}
      </div>
      <div className="relative mt-4">
        <div className="absolute top-0 left-0 h-1 bg-gray-200 w-full"></div>
        <div 
          className="absolute top-0 left-0 h-1 bg-blue-600 transition-all duration-300"
          style={{ width: `${((currentStep - 1) / (totalSteps - 1)) * 100}%` }}
        ></div>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white py-8 px-4">
      <div className="max-w-4xl mx-auto">
        <div className="mb-8 text-center">
          <div className="flex justify-center mb-4">
            <Users className="text-orange-500" size={48} />
          </div>
          <h1 className="text-3xl font-bold text-blue-900">Nova Tech Dealer Application</h1>
          <p className="text-gray-600 mt-2">Complete all steps to apply for dealership</p>
          <div className="mt-4 bg-gradient-to-r from-blue-50 to-green-50 p-3 rounded-lg inline-block border">
            <p className="text-sm text-gray-700 flex items-center gap-2">
              {contactMethod === 'email' ? <Mail size={16} /> : <MessageCircle size={16} />}
              <strong>Communication Method:</strong> {contactMethod === 'email' ? 'Email' : 'WhatsApp'}
            </p>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-lg p-8">
          <StepIndicator />

          <form onSubmit={handleSubmit}>
            {currentStep === 1 && (
              <div className="space-y-6">
                <h2 className="text-2xl font-bold text-blue-800 mb-4">Personal Information</h2>
                
                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Full Name *
                    </label>
                    <input
                      type="text"
                      name="fullName"
                      value={formData.fullName}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Father's Name *
                    </label>
                    <input
                      type="text"
                      name="fatherName"
                      value={formData.fatherName}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Mother's Name *
                    </label>
                    <input
                      type="text"
                      name="motherName"
                      value={formData.motherName}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Date of Birth *
                    </label>
                    <input
                      type="date"
                      name="dateOfBirth"
                      value={formData.dateOfBirth}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      NID Number *
                    </label>
                    <input
                      type="text"
                      name="nidNumber"
                      value={formData.nidNumber}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Mobile Number *
                    </label>
                    <div className="flex">
                      <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                        +880
                      </span>
                      <input
                        type="tel"
                        name="mobileNumber"
                        value={formData.mobileNumber}
                        onChange={handleChange}
                        className="flex-1 min-w-0 block w-full px-3 py-3 rounded-r-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                        placeholder="1XXXXXXXXXX"
                        pattern="[0-9]{11}"
                        maxLength="11"
                        required
                      />
                    </div>
                    <p className="text-xs text-gray-500 mt-1">
                      For WhatsApp communications
                    </p>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Email Address *
                    </label>
                    <input
                      type="email"
                      name="email"
                      value={formData.email}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                    <p className="text-xs text-gray-500 mt-1">
                      For email communications
                    </p>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Present Address *
                  </label>
                  <textarea
                    name="presentAddress"
                    value={formData.presentAddress}
                    onChange={handleChange}
                    rows="3"
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                    required
                  ></textarea>
                </div>
              </div>
            )}

            {currentStep === 2 && (
              <div className="space-y-6">
                <h2 className="text-2xl font-bold text-blue-800 mb-4">Business Information</h2>
                
                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Shop/Business Name *
                    </label>
                    <input
                      type="text"
                      name="shopName"
                      value={formData.shopName}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Trade License Number *
                    </label>
                    <input
                      type="text"
                      name="tradeLicenseNumber"
                      value={formData.tradeLicenseNumber}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Division *
                    </label>
                    <select
                      name="division"
                      value={formData.division}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    >
                      <option value="">Select Division</option>
                      {Object.keys(BANGLADESH_DISTRICTS).map(division => (
                        <option key={division} value={division}>{division}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      District *
                    </label>
                    <select
                      name="district"
                      value={formData.district}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                      disabled={!formData.division}
                    >
                      <option value="">Select District</option>
                      {districts.map(district => (
                        <option key={district} value={district}>{district}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Upazila/Thana *
                    </label>
                    <input
                      type="text"
                      name="upazila"
                      value={formData.upazila}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Business Type *
                    </label>
                    <select
                      name="businessType"
                      value={formData.businessType}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    >
                      <option value="">Select Business Type</option>
                      <option value="electronics">Electronics Shop</option>
                      <option value="mobile">Mobile Accessories Shop</option>
                      <option value="hardware">Hardware Store</option>
                      <option value="general">General Store</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Monthly Income (Approx.) *
                    </label>
                    <input
                      type="number"
                      name="monthlyIncome"
                      value={formData.monthlyIncome}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Business/Shop Address *
                  </label>
                  <textarea
                    name="businessAddress"
                    value={formData.businessAddress}
                    onChange={handleChange}
                    rows="3"
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                    required
                  ></textarea>
                </div>
              </div>
            )}

            {currentStep === 3 && (
              <div className="space-y-6">
                <h2 className="text-2xl font-bold text-blue-800 mb-4">Financial Information</h2>
                
                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Bank Name *
                    </label>
                    <input
                      type="text"
                      name="bankName"
                      value={formData.bankName}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Account Number *
                    </label>
                    <input
                      type="text"
                      name="accountNumber"
                      value={formData.accountNumber}
                      onChange={handleChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                      required
                    />
                  </div>
                </div>

                <div className={`p-6 rounded-lg ${contactMethod === 'email' ? 'bg-blue-50' : 'bg-green-50'}`}>
                  <h3 className={`font-bold ${contactMethod === 'email' ? 'text-blue-800' : 'text-green-800'} mb-2 flex items-center gap-2`}>
                    {contactMethod === 'email' ? <Mail size={20} /> : <MessageCircle size={20} />}
                    {contactMethod === 'email' ? 'Email' : 'WhatsApp'} Updates
                  </h3>
                  <ul className="space-y-2 text-sm text-gray-700">
                    <li className="flex items-center gap-2">
                      <CheckCircle size={16} className="text-green-500" />
                      Application status updates via {contactMethod === 'email' ? 'Email' : 'WhatsApp'}
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle size={16} className="text-green-500" />
                      Payment confirmation via {contactMethod === 'email' ? 'Email' : 'WhatsApp'}
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle size={16} className="text-green-500" />
                      Order tracking via {contactMethod === 'email' ? 'Email' : 'WhatsApp'}
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle size={16} className="text-green-500" />
                      24/7 support available
                    </li>
                  </ul>
                </div>
              </div>
            )}

            {currentStep === 4 && (
              <div className="space-y-6">
                <h2 className="text-2xl font-bold text-blue-800 mb-4">Review & Submit</h2>
                
                <div className="bg-gray-50 p-6 rounded-lg">
                  <h3 className="font-bold text-gray-800 mb-4">Application Summary</h3>
                  
                  <div className="space-y-4">
                    <div>
                      <h4 className="font-medium text-gray-700 mb-2">Personal Information</h4>
                      <div className="grid md:grid-cols-2 gap-4 text-sm">
                        <div><strong>Name:</strong> {formData.fullName}</div>
                        <div><strong>Mobile:</strong> {formData.mobileNumber}</div>
                        <div><strong>Email:</strong> {formData.email}</div>
                        <div><strong>NID:</strong> {formData.nidNumber}</div>
                      </div>
                    </div>
                    
                    <div>
                      <h4 className="font-medium text-gray-700 mb-2">Business Information</h4>
                      <div className="grid md:grid-cols-2 gap-4 text-sm">
                        <div><strong>Shop Name:</strong> {formData.shopName}</div>
                        <div><strong>Location:</strong> {formData.district}, {formData.division}</div>
                        <div><strong>Business Type:</strong> {formData.businessType}</div>
                        <div><strong>Monthly Income:</strong> à§³{formData.monthlyIncome}</div>
                      </div>
                    </div>
                    
                    <div>
                      <h4 className="font-medium text-gray-700 mb-2">Financial Information</h4>
                      <div className="grid md:grid-cols-2 gap-4 text-sm">
                        <div><strong>Bank:</strong> {formData.bankName}</div>
                        <div><strong>Account:</strong> {formData.accountNumber}</div>
                      </div>
                    </div>
                    
                    <div>
                      <h4 className="font-medium text-gray-700 mb-2">Communication Method</h4>
                      <div className="text-sm">
                        <div className="flex items-center gap-2">
                          {contactMethod === 'email' ? <Mail size={16} /> : <MessageCircle size={16} />}
                          <span>All updates will be sent via <strong>{contactMethod === 'email' ? 'Email' : 'WhatsApp'}</strong></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-yellow-50 p-6 rounded-lg">
                  <div className="flex items-start">
                    <input
                      type="checkbox"
                      id="termsAccepted"
                      name="termsAccepted"
                      checked={formData.termsAccepted}
                      onChange={handleChange}
                      className="h-5 w-5 text-blue-600 rounded mt-1"
                      required
                    />
                    <label htmlFor="termsAccepted" className="ml-2">
                      <span className="font-medium">I agree to the terms and conditions *</span>
                      <p className="text-sm text-gray-600 mt-1">
                        I declare that all information provided is true and correct. 
                        I understand that Nova Tech will verify all information and 
                        communicate with me via {contactMethod === 'email' ? 'Email' : 'WhatsApp'}.
                      </p>
                    </label>
                  </div>
                </div>
              </div>
            )}

            <div className="flex justify-between mt-8 pt-6 border-t border-gray-200">
              {currentStep > 1 ? (
                <button
                  type="button"
                  onClick={prevStep}
                  className="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition"
                >
                  <ArrowLeft size={20} className="inline mr-2" />
                  Previous
                </button>
              ) : (
                <button
                  type="button"
                  onClick={onBack}
                  className="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition"
                >
                  <ArrowLeft size={20} className="inline mr-2" />
                  Back to OTP
                </button>
              )}

              {currentStep < totalSteps ? (
                <button
                  type="button"
                  onClick={nextStep}
                  className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition"
                >
                  Next Step
                  <ArrowRight size={20} className="inline ml-2" />
                </button>
              ) : (
                <button
                  type="submit"
                  disabled={!formData.termsAccepted}
                  className={`px-6 py-3 ${
                    contactMethod === 'email' 
                      ? 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700' 
                      : 'bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700'
                  } text-white rounded-lg font-medium transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2`}
                >
                  {contactMethod === 'email' ? <Mail size={20} /> : <MessageCircle size={20} />}
                  Submit via {contactMethod === 'email' ? 'Email' : 'WhatsApp'}
                </button>
              )}
            </div>
          </form>
        </div>

        <div className="mt-8 bg-blue-50 rounded-lg p-6">
          <h3 className="font-bold text-blue-800 mb-2 flex items-center gap-2">
            <Headphones size={20} />
            Need Help?
          </h3>
          <p className="text-sm text-gray-700 mb-4">
            Contact our dealer support team:
          </p>
          <div className="flex flex-wrap gap-4">
            <a 
              href={`https://wa.me/${ADMIN_NUMBERS.WHATSAPP}`}
              target="_blank"
              rel="noopener noreferrer"
              className="bg-green-100 text-green-700 px-4 py-2 rounded-lg font-medium hover:bg-green-200 transition flex items-center gap-2"
            >
              <MessageCircle size={16} />
              WhatsApp Support
            </a>
            <a 
              href={SOCIAL_LINKS.EMAIL}
              className="bg-blue-100 text-blue-700 px-4 py-2 rounded-lg font-medium hover:bg-blue-200 transition flex items-center gap-2"
            >
              <Mail size={16} />
              Email Support
            </a>
            <a 
              href={SOCIAL_LINKS.PHONE}
              className="bg-orange-100 text-orange-700 px-4 py-2 rounded-lg font-medium hover:bg-orange-200 transition flex items-center gap-2"
            >
              <Phone size={16} />
              Call: {ADMIN_NUMBERS.GP}
            </a>
          </div>
        </div>
      </div>
    </div>
  );
};

// 4. Application Success Component
const ApplicationSuccess = ({ applicationId, contactInfo, contactMethod, onBack }) => {
  const handleConfirmation = () => {
    const message = `ðŸŽ‰ Thank you! Your Nova Tech Dealer Application #${applicationId} has been received.\n\nOur team will review your application and contact you within 24 hours.\n\nYou can track your application status by replying to this message.\n\n- Nova Tech BD Team`;
    
    if (contactMethod === 'email') {
      const subject = 'Nova Tech Dealer Application Confirmation';
      const emailUrl = `mailto:${contactInfo}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(message)}`;
      window.open(emailUrl, '_blank');
    } else {
      const whatsappUrl = `https://wa.me/${contactInfo}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }
  };

  const getContactIcon = () => {
    return contactMethod === 'email' ? <Mail size={24} /> : <MessageCircle size={24} />;
  };

  const getContactMethodName = () => {
    return contactMethod === 'email' ? 'Email' : 'WhatsApp';
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white py-8 px-4">
      <div className="max-w-md mx-auto">
        <div className="bg-white rounded-xl shadow-lg p-8 text-center">
          <div className="mb-6">
            <div className="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <Check className="text-green-500" size={48} />
            </div>
            
            <h2 className="text-3xl font-bold text-green-700 mb-2">
              Application Submitted Successfully!
            </h2>
            
            <p className="text-gray-600 mb-6">
              Your dealer application has been received and is under review.
            </p>
            
            <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
              <p className="font-bold text-green-800 mb-2">Application ID:</p>
              <p className="text-2xl font-mono font-bold text-green-700">{applicationId}</p>
              <p className="text-sm text-green-600 mt-2">
                Keep this ID for future reference
              </p>
            </div>
            
            <div className={`p-4 rounded-lg mb-6 ${contactMethod === 'email' ? 'bg-blue-50' : 'bg-green-50'}`}>
              <h4 className="font-bold text-gray-800 mb-2 flex items-center justify-center gap-2">
                {getContactIcon()}
                {getContactMethodName()} Confirmation
              </h4>
              <p className="text-sm text-gray-700">
                Confirmation sent to: <strong>{contactInfo}</strong>
              </p>
              <p className="text-xs text-gray-600 mt-1">
                All updates will be sent via {getContactMethodName()}
              </p>
            </div>
          </div>
          
          <div className="space-y-4">
            <div className="bg-blue-50 p-4 rounded-lg">
              <h4 className="font-bold text-blue-800 mb-2">Next Steps:</h4>
              <ul className="text-sm text-left text-gray-700 space-y-1">
                <li className="flex items-center gap-2">
                  <CheckCircle size={16} className="text-green-500" />
                  Document verification (3-5 working days)
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={16} className="text-green-500" />
                  {getContactMethodName()} interview with admin
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={16} className="text-green-500" />
                  Site visit if required
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={16} className="text-green-500" />
                  Final approval via {getContactMethodName()}
                </li>
              </ul>
            </div>
            
            <div className={`p-4 rounded-lg ${contactMethod === 'email' ? 'bg-blue-50' : 'bg-green-50'}`}>
              <h4 className="font-bold text-gray-800 mb-2">{getContactMethodName()} Communications:</h4>
              <p className="text-sm text-gray-700">
                All communications will be sent to <strong>{contactInfo}</strong> via {getContactMethodName()}.
              </p>
            </div>
            
            <button
              onClick={handleConfirmation}
              className={`w-full px-6 py-3 ${
                contactMethod === 'email' 
                  ? 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700' 
                  : 'bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700'
              } text-white rounded-lg font-bold transition mt-6 flex items-center justify-center gap-2`}
            >
              {getContactIcon()}
              Send {getContactMethodName()} Confirmation
            </button>
            
            <button
              onClick={onBack}
              className="w-full px-6 py-3 bg-gray-600 text-white rounded-lg font-bold hover:bg-gray-700 transition mt-2"
            >
              <Home size={20} className="inline mr-2" />
              Back to Home
            </button>
            
            <div className="mt-6">
              <p className="text-sm text-gray-600">
                Need immediate assistance? 
                {contactMethod === 'email' ? (
                  <a 
                    href={SOCIAL_LINKS.EMAIL}
                    className="text-blue-600 font-bold ml-2"
                  >
                    Email: jisbusinessbd@gmail.com
                  </a>
                ) : (
                  <a 
                    href={`https://wa.me/${ADMIN_NUMBERS.WHATSAPP}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-green-600 font-bold ml-2"
                  >
                    WhatsApp: {ADMIN_NUMBERS.WHATSAPP}
                  </a>
                )}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// ==================== CHECKOUT SYSTEM COMPONENTS ====================

// Checkout Form Component
const CheckoutForm = ({ cart, onClose, onSuccess }) => {
  const [step, setStep] = useState('shipping');
  const [formData, setFormData] = useState({
    name: '',
    phone: '',
    email: '',
    division: '',
    district: '',
    upazila: '',
    address: '',
    note: ''
  });
  
  const [paymentMethod, setPaymentMethod] = useState('sslcommerz');
  const [bkashNumber, setBkashNumber] = useState(ADMIN_NUMBERS.GP);
  const [nagadNumber, setNagadNumber] = useState(ADMIN_NUMBERS.GP);
  const [rocketNumber, setRocketNumber] = useState(ADMIN_NUMBERS.GP);
  const [transactionId, setTransactionId] = useState('');
  const [loading, setLoading] = useState(false);
  const [districts, setDistricts] = useState([]);

  useEffect(() => {
    if (formData.division && BANGLADESH_DISTRICTS[formData.division]) {
      setDistricts(BANGLADESH_DISTRICTS[formData.division]);
    }
  }, [formData.division]);

  const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
  const shippingCharge = cartTotal > 1000 ? 0 : 60;
  const totalAmount = cartTotal + shippingCharge;

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handlePlaceOrder = async () => {
    if (!formData.name || !formData.phone || !formData.email || 
        !formData.division || !formData.district || !formData.address) {
      alert('Please fill all required shipping information');
      return;
    }

    setLoading(true);

    // Generate unique order ID
    const orderId = 'NT' + Date.now().toString().slice(-8) + Math.floor(Math.random() * 100).toString().padStart(2, '0');
    
    const orderData = {
      orderId,
      customer: formData,
      items: cart,
      payment: {
        method: paymentMethod,
        amount: totalAmount,
        status: paymentMethod === 'cod' ? 'pending' : 'pending_payment',
        transactionId: transactionId || null
      },
      shipping: {
        division: formData.division,
        district: formData.district,
        upazila: formData.upazila,
        address: formData.address,
        charge: shippingCharge
      },
      date: new Date().toISOString(),
      status: 'processing'
    };

    // Save order to localStorage
    const orders = JSON.parse(localStorage.getItem('nova_orders') || '[]');
    orders.push(orderData);
    localStorage.setItem('nova_orders', JSON.stringify(orders));
    
    // Clear cart
    localStorage.removeItem('nova_cart');

    // Send notifications
    sendOrderConfirmation(orderData);
    
    setLoading(false);
    onSuccess(orderId, orderData);
  };

  const sendOrderConfirmation = (orderData) => {
    const orderSummary = orderData.items.map(item => 
      `${item.name} x${item.qty} = à§³${item.price * item.qty}`
    ).join('\n');

    const message = `ðŸ›’ *New Order Received!*\n\nðŸ“¦ Order ID: ${orderData.orderId}\nðŸ‘¤ Customer: ${orderData.customer.name}\nðŸ“ž Phone: ${orderData.customer.phone}\nðŸ“ Location: ${orderData.customer.district}, ${orderData.customer.division}\n\nðŸ“‹ *Order Details:*\n${orderSummary}\n\nðŸšš Shipping: à§³${orderData.shipping.charge}\nðŸ’° Total: à§³${orderData.payment.amount}\n\nðŸ’³ Payment: ${orderData.payment.method.toUpperCase()}\n${orderData.payment.transactionId ? `ðŸ“ Transaction ID: ${orderData.payment.transactionId}` : ''}\n\nðŸ“ Note: ${orderData.customer.note || 'No note provided'}`;

    // Send to admin
    const adminWhatsAppUrl = `https://wa.me/${ADMIN_NUMBERS.WHATSAPP}?text=${encodeURIComponent(message)}`;
    window.open(adminWhatsAppUrl, '_blank');

    // Send to customer
    const customerMessage = `âœ… *Your Order is Confirmed!*\n\nðŸ“¦ Order ID: ${orderData.orderId}\nðŸ‘¤ Name: ${orderData.customer.name}\nðŸ“ž Contact: ${orderData.customer.phone}\n\nðŸ“‹ *Your Order:*\n${orderSummary}\n\nðŸšš Shipping: à§³${orderData.shipping.charge}\nðŸ’° Total: à§³${orderData.payment.amount}\n\nðŸ’³ Payment Method: ${orderData.payment.method.toUpperCase()}\n${orderData.payment.transactionId ? `ðŸ“ Your Transaction ID: ${orderData.payment.transactionId}` : ''}\n\nðŸ“¦ *Delivery Information:*\nWe'll deliver within 3-5 working days to:\n${orderData.customer.address}, ${orderData.customer.upazila}, ${orderData.customer.district}, ${orderData.customer.division}\n\nðŸ“ž Contact: ${ADMIN_NUMBERS.GP}\nðŸ“§ Email: ${OTP_CONFIG.EMAIL.SENDER}\n\nThank you for shopping with Nova Tech!`;
    
    const customerWhatsAppUrl = `https://wa.me/${formatBangladeshiNumber(orderData.customer.phone)}?text=${encodeURIComponent(customerMessage)}`;
    window.open(customerWhatsAppUrl, '_blank');
  };

  const handleSSLCommerzPayment = () => {
    // This is a mock SSLCOMMERZ integration
    // In real implementation, you would redirect to SSLCOMMERZ payment page
    const sslcommerzData = {
      store_id: 'novatech',
      store_passwd: 'password',
      total_amount: totalAmount,
      currency: 'BDT',
      tran_id: 'NT' + Date.now(),
      success_url: `${window.location.origin}/payment-success`,
      fail_url: `${window.location.origin}/payment-fail`,
      cancel_url: `${window.location.origin}/payment-cancel`,
      cus_name: formData.name,
      cus_email: formData.email,
      cus_phone: formData.phone,
      cus_add1: formData.address,
      cus_city: formData.district,
      cus_country: 'Bangladesh',
      shipping_method: 'Courier',
      product_name: `Nova Tech Order - ${cart.length} items`,
      product_category: 'Electronics',
      product_profile: 'general'
    };

    alert(`SSLCOMMERZ Payment would be initiated here\nTotal Amount: à§³${totalAmount}\n\nFor testing, you can proceed with manual payment methods.`);
    setPaymentMethod('sslcommerz');
  };

  const renderShippingStep = () => (
    <div className="space-y-4">
      <h3 className="text-xl font-bold text-blue-800 mb-4">Shipping Information</h3>
      
      <div className="grid md:grid-cols-2 gap-4">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Full Name *
          </label>
          <input
            type="text"
            name="name"
            value={formData.name}
            onChange={handleChange}
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Phone Number *
          </label>
          <div className="flex">
            <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
              +880
            </span>
            <input
              type="tel"
              name="phone"
              value={formData.phone}
              onChange={handleChange}
              className="flex-1 min-w-0 block w-full px-3 py-3 rounded-r-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
              placeholder="1XXXXXXXXXX"
              pattern="[0-9]{11}"
              maxLength="11"
              required
            />
          </div>
        </div>
      </div>

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Email Address *
        </label>
        <input
          type="email"
          name="email"
          value={formData.email}
          onChange={handleChange}
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          required
        />
      </div>

      <div className="grid md:grid-cols-3 gap-4">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Division *
          </label>
          <select
            name="division"
            value={formData.division}
            onChange={handleChange}
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            required
          >
            <option value="">Select Division</option>
            {Object.keys(BANGLADESH_DISTRICTS).map(division => (
              <option key={division} value={division}>{division}</option>
            ))}
          </select>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            District *
          </label>
          <select
            name="district"
            value={formData.district}
            onChange={handleChange}
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            required
            disabled={!formData.division}
          >
            <option value="">Select District</option>
            {districts.map(district => (
              <option key={district} value={district}>{district}</option>
            ))}
          </select>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Upazila/Thana *
          </label>
          <input
            type="text"
            name="upazila"
            value={formData.upazila}
            onChange={handleChange}
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            required
          />
        </div>
      </div>

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Complete Address *
        </label>
        <textarea
          name="address"
          value={formData.address}
          onChange={handleChange}
          rows="3"
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          placeholder="House #, Road #, Village, Area"
          required
        ></textarea>
      </div>

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Order Note (Optional)
        </label>
        <textarea
          name="note"
          value={formData.note}
          onChange={handleChange}
          rows="2"
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          placeholder="Any special instructions for delivery"
        ></textarea>
      </div>

      <button
        onClick={() => setStep('payment')}
        className="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-blue-800 transition-all mt-4"
      >
        Continue to Payment
      </button>
    </div>
  );

  const renderPaymentStep = () => (
    <div className="space-y-6">
      <h3 className="text-xl font-bold text-blue-800 mb-4">Select Payment Method</h3>
      
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <button
          onClick={() => setPaymentMethod('sslcommerz')}
          className={`p-6 border-2 rounded-xl flex flex-col items-center justify-center gap-3 transition-all ${
            paymentMethod === 'sslcommerz'
              ? 'border-blue-500 bg-blue-50'
              : 'border-gray-300 hover:border-blue-300'
          }`}
        >
          <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
            <CreditCard className="text-blue-600" size={24} />
          </div>
          <span className="font-bold text-gray-800">SSLCOMMERZ</span>
          <span className="text-sm text-gray-600">Card/Bank/Internet Banking</span>
          <div className="flex gap-1">
            {['Visa', 'Mastercard', 'Amex', 'bKash', 'Nagad'].map((method) => (
              <span key={method} className="text-xs bg-gray-100 px-2 py-1 rounded">
                {method}
              </span>
            ))}
          </div>
        </button>

        <button
          onClick={() => setPaymentMethod('bkash')}
          className={`p-6 border-2 rounded-xl flex flex-col items-center justify-center gap-3 transition-all ${
            paymentMethod === 'bkash'
              ? 'border-pink-500 bg-pink-50'
              : 'border-gray-300 hover:border-pink-300'
          }`}
        >
          <div className="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center">
            <span className="font-bold text-pink-600">bKash</span>
          </div>
          <span className="font-bold text-gray-800">bKash</span>
          <span className="text-sm text-gray-600">Send Money to: {bkashNumber}</span>
          <div className="text-xs text-gray-500">Personal/Agent Banking</div>
        </button>

        <button
          onClick={() => setPaymentMethod('nagad')}
          className={`p-6 border-2 rounded-xl flex flex-col items-center justify-center gap-3 transition-all ${
            paymentMethod === 'nagad'
              ? 'border-red-500 bg-red-50'
              : 'border-gray-300 hover:border-red-300'
          }`}
        >
          <div className="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
            <span className="font-bold text-red-600">Nagad</span>
          </div>
          <span className="font-bold text-gray-800">Nagad</span>
          <span className="text-sm text-gray-600">Send Money to: {nagadNumber}</span>
          <div className="text-xs text-gray-500">Personal/Agent Banking</div>
        </button>

        <button
          onClick={() => setPaymentMethod('rocket')}
          className={`p-6 border-2 rounded-xl flex flex-col items-center justify-center gap-3 transition-all ${
            paymentMethod === 'rocket'
              ? 'border-purple-500 bg-purple-50'
              : 'border-gray-300 hover:border-purple-300'
          }`}
        >
          <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
            <span className="font-bold text-purple-600">Rocket</span>
          </div>
          <span className="font-bold text-gray-800">DBBL Rocket</span>
          <span className="text-sm text-gray-600">Send Money to: {rocketNumber}</span>
          <div className="text-xs text-gray-500">DBBL Mobile Banking</div>
        </button>

        <button
          onClick={() => setPaymentMethod('bank')}
          className={`p-6 border-2 rounded-xl flex flex-col items-center justify-center gap-3 transition-all ${
            paymentMethod === 'bank'
              ? 'border-green-500 bg-green-50'
              : 'border-gray-300 hover:border-green-300'
          }`}
        >
          <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
            <Building className="text-green-600" size={24} />
          </div>
          <span className="font-bold text-gray-800">Bank Transfer</span>
          <span className="text-sm text-gray-600">Direct Bank Deposit</span>
          <div className="text-xs text-center text-gray-500">
            Bank Asia<br/>A/C: 5031070007530
          </div>
        </button>

        <button
          onClick={() => setPaymentMethod('cod')}
          className={`p-6 border-2 rounded-xl flex flex-col items-center justify-center gap-3 transition-all ${
            paymentMethod === 'cod'
              ? 'border-orange-500 bg-orange-50'
              : 'border-gray-300 hover:border-orange-300'
          }`}
        >
          <div className="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
            <Truck className="text-orange-600" size={24} />
          </div>
          <span className="font-bold text-gray-800">Cash on Delivery</span>
          <span className="text-sm text-gray-600">Pay when you receive</span>
          <div className="text-xs text-gray-500">Available nationwide</div>
        </button>
      </div>

      {paymentMethod !== 'sslcommerz' && paymentMethod !== 'cod' && (
        <div className="p-6 bg-gray-50 rounded-xl">
          <h4 className="font-bold text-gray-800 mb-3">
            Payment Instructions for {paymentMethod.toUpperCase()}
          </h4>
          <div className="space-y-3">
            <div className="flex items-center justify-between">
              <span className="text-gray-600">Send Money to:</span>
              <span className="font-bold text-lg">
                {paymentMethod === 'bkash' ? bkashNumber :
                 paymentMethod === 'nagad' ? nagadNumber :
                 paymentMethod === 'rocket' ? rocketNumber :
                 'Bank Account'}
              </span>
            </div>
            
            {paymentMethod === 'bank' && (
              <div className="bg-white p-4 rounded-lg border">
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <span className="text-gray-600 text-sm">Bank:</span>
                    <p className="font-bold">Bank Asia Limited</p>
                  </div>
                  <div>
                    <span className="text-gray-600 text-sm">A/C No:</span>
                    <p className="font-bold">5031070007530</p>
                  </div>
                  <div>
                    <span className="text-gray-600 text-sm">A/C Name:</span>
                    <p className="font-bold">NOVA TECH BD</p>
                  </div>
                  <div>
                    <span className="text-gray-600 text-sm">Branch:</span>
                    <p className="font-bold">Motijheel</p>
                  </div>
                </div>
              </div>
            )}

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Transaction ID / Reference *
              </label>
              <input
                type="text"
                value={transactionId}
                onChange={(e) => setTransactionId(e.target.value)}
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                placeholder={`Enter your ${paymentMethod} transaction ID`}
                required
              />
              <p className="text-xs text-gray-500 mt-1">
                Must be 10-16 characters. Save this ID for verification.
              </p>
            </div>
          </div>
        </div>
      )}

      <div className="flex gap-4">
        <button
          onClick={() => setStep('shipping')}
          className="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-bold hover:bg-gray-50 transition"
        >
          Back
        </button>
        
        {paymentMethod === 'sslcommerz' ? (
          <button
            onClick={handleSSLCommerzPayment}
            className="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-blue-800 transition-all"
          >
            Pay with SSLCOMMERZ (à§³{totalAmount})
          </button>
        ) : (
          <button
            onClick={handlePlaceOrder}
            disabled={loading || (paymentMethod !== 'cod' && !transactionId)}
            className="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg font-bold hover:from-green-600 hover:to-green-700 transition-all disabled:opacity-50"
          >
            {loading ? 'Processing...' : `Place Order (à§³${totalAmount})`}
          </button>
        )}
      </div>
    </div>
  );

  const renderOrderSummary = () => (
    <div className="bg-gray-50 p-6 rounded-xl">
      <h3 className="text-xl font-bold text-blue-800 mb-4">Order Summary</h3>
      
      <div className="space-y-4">
        {cart.map(item => (
          <div key={item.id} className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <img src={item.image} alt={item.name} className="w-16 h-16 object-cover rounded" />
              <div>
                <p className="font-medium">{item.name}</p>
                <p className="text-sm text-gray-600">Qty: {item.qty}</p>
              </div>
            </div>
            <span className="font-bold">à§³{item.price * item.qty}</span>
          </div>
        ))}
        
        <div className="border-t pt-4 space-y-2">
          <div className="flex justify-between">
            <span>Subtotal</span>
            <span>à§³{cartTotal}</span>
          </div>
          <div className="flex justify-between">
            <span>Shipping</span>
            <span>à§³{shippingCharge}</span>
          </div>
          <div className="flex justify-between text-lg font-bold border-t pt-2">
            <span>Total</span>
            <span className="text-orange-600">à§³{totalAmount}</span>
          </div>
        </div>
      </div>
    </div>
  );

  if (cart.length === 0) {
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white rounded-xl p-8 max-w-md w-full text-center">
          <ShoppingCart size={64} className="text-gray-400 mx-auto mb-4" />
          <h3 className="text-xl font-bold text-gray-800 mb-2">Your cart is empty</h3>
          <p className="text-gray-600 mb-6">Add some products to checkout</p>
          <button
            onClick={onClose}
            className="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-bold"
          >
            Continue Shopping
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
      <div className="bg-white rounded-2xl max-w-6xl w-full shadow-2xl my-8">
        <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6 rounded-t-2xl">
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                <ShoppingBag size={24} />
              </div>
              <div>
                <h2 className="text-xl font-bold">Checkout</h2>
                <p className="text-blue-100 text-sm">
                  {step === 'shipping' ? 'Step 1: Shipping Information' : 'Step 2: Payment Method'}
                </p>
              </div>
            </div>
            <button
              onClick={onClose}
              className="text-white hover:text-blue-200"
            >
              <X size={24} />
            </button>
          </div>
        </div>
        
        <div className="grid md:grid-cols-3 gap-8 p-6">
          <div className="md:col-span-2">
            {step === 'shipping' ? renderShippingStep() : renderPaymentStep()}
          </div>
          
          <div className="md:col-span-1">
            {renderOrderSummary()}
            
            <div className="mt-6 bg-blue-50 p-4 rounded-xl">
              <h4 className="font-bold text-blue-800 mb-2 flex items-center gap-2">
                <ShieldCheck size={20} />
                Secure Checkout
              </h4>
              <ul className="space-y-1 text-sm text-gray-700">
                <li className="flex items-center gap-2">
                  <CheckCircle size={16} className="text-green-500" />
                  256-bit SSL Encryption
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={16} className="text-green-500" />
                  Secure Payment Gateway
                </li>
                <li className="flex items-center gap-2">
                  <CheckCircle size={16} className="text-green-500" />
                  Money Back Guarantee
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// Cart Modal Component
const CartModal = ({ cart, onClose, onUpdateCart, onCheckout }) => {
  const [showCheckout, setShowCheckout] = useState(false);

  const updateQuantity = (id, change) => {
    const updatedCart = cart.map(item => {
      if (item.id === id) {
        const newQty = item.qty + change;
        return newQty > 0 ? { ...item, qty: newQty } : null;
      }
      return item;
    }).filter(Boolean);
    
    onUpdateCart(updatedCart);
  };

  const removeItem = (id) => {
    const updatedCart = cart.filter(item => item.id !== id);
    onUpdateCart(updatedCart);
  };

  const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
  const shippingCharge = cartTotal > 1000 ? 0 : 60;
  const totalAmount = cartTotal + shippingCharge;

  if (showCheckout) {
    return (
      <CheckoutForm
        cart={cart}
        onClose={() => setShowCheckout(false)}
        onSuccess={(orderId, orderData) => {
          onClose();
          alert(`Order placed successfully!\nOrder ID: ${orderId}\nWe have sent confirmation to your WhatsApp/Email.`);
        }}
      />
    );
  }

  if (cart.length === 0) {
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white rounded-xl p-8 max-w-md w-full">
          <div className="text-center">
            <ShoppingCart size={64} className="text-gray-400 mx-auto mb-4" />
            <h3 className="text-xl font-bold text-gray-800 mb-2">Your cart is empty</h3>
            <p className="text-gray-600 mb-6">Add some products to get started</p>
            <button
              onClick={onClose}
              className="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-bold"
            >
              Continue Shopping
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
        <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6">
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-3">
              <ShoppingCart size={28} />
              <h2 className="text-xl font-bold">Your Shopping Cart</h2>
            </div>
            <button onClick={onClose} className="text-white hover:text-blue-200">
              <X size={24} />
            </button>
          </div>
          <p className="text-blue-100 mt-2">{cart.length} items in cart</p>
        </div>
        
        <div className="flex-1 overflow-y-auto p-6">
          <div className="space-y-4">
            {cart.map(item => (
              <div key={item.id} className="flex items-center gap-4 p-4 border rounded-lg">
                <img src={item.image} alt={item.name} className="w-20 h-20 object-cover rounded" />
                
                <div className="flex-1">
                  <h3 className="font-bold text-gray-800">{item.name}</h3>
                  <p className="text-sm text-gray-600">{item.description}</p>
                  <div className="flex items-center gap-4 mt-2">
                    <div className="flex items-center gap-2">
                      <button
                        onClick={() => updateQuantity(item.id, -1)}
                        className="w-8 h-8 flex items-center justify-center border rounded-full hover:bg-gray-100"
                      >
                        <Minus size={16} />
                      </button>
                      <span className="font-bold w-8 text-center">{item.qty}</span>
                      <button
                        onClick={() => updateQuantity(item.id, 1)}
                        className="w-8 h-8 flex items-center justify-center border rounded-full hover:bg-gray-100"
                      >
                        <Plus size={16} />
                      </button>
                    </div>
                    <span className="font-bold text-orange-600">à§³{item.price * item.qty}</span>
                    <button
                      onClick={() => removeItem(item.id)}
                      className="text-red-500 hover:text-red-700"
                    >
                      <Trash2 size={20} />
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
        
        <div className="border-t p-6">
          <div className="space-y-3 mb-6">
            <div className="flex justify-between">
              <span className="text-gray-600">Subtotal</span>
              <span className="font-bold">à§³{cartTotal}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-600">Shipping</span>
              <span className="font-bold">à§³{shippingCharge}</span>
            </div>
            <div className="flex justify-between text-lg font-bold border-t pt-3">
              <span>Total</span>
              <span className="text-orange-600">à§³{totalAmount}</span>
            </div>
          </div>
          
          <div className="flex gap-4">
            <button
              onClick={onClose}
              className="flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-50"
            >
              Continue Shopping
            </button>
            <button
              onClick={() => setShowCheckout(true)}
              className="flex-1 bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3 rounded-lg font-bold hover:from-orange-600 hover:to-orange-700"
            >
              Proceed to Checkout
            </button>
          </div>
          
          <div className="mt-4 text-center">
            <p className="text-sm text-gray-600">
              <ShieldCheck size={16} className="inline mr-2" />
              Secure checkout with SSL encryption
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

// Order Confirmation Component
const OrderConfirmation = ({ orderId, orderData, onClose }) => {
  const handlePrint = () => {
    window.print();
  };

  const handleShare = () => {
    const message = `âœ… *Order Confirmed!*\n\nðŸ“¦ Order ID: ${orderId}\nðŸ’° Total: à§³${orderData.payment.amount}\nðŸ“ Delivery to: ${orderData.customer.district}\n\nTrack your order with Nova Tech!`;
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-2xl w-full shadow-2xl">
        <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-t-2xl">
          <div className="text-center">
            <div className="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
              <Check size={40} />
            </div>
            <h2 className="text-2xl font-bold mb-2">Order Placed Successfully!</h2>
            <p className="text-green-100">Your order has been confirmed</p>
          </div>
        </div>
        
        <div className="p-6">
          <div className="bg-green-50 border border-green-200 rounded-xl p-4 mb-6">
            <div className="text-center">
              <p className="text-sm text-green-700 mb-1">Order ID</p>
              <p className="text-2xl font-bold text-green-800 font-mono">{orderId}</p>
              <p className="text-xs text-green-600 mt-1">Save this ID for tracking</p>
            </div>
          </div>
          
          <div className="space-y-4 mb-6">
            <div className="grid md:grid-cols-2 gap-4">
              <div className="bg-blue-50 p-4 rounded-lg">
                <h4 className="font-bold text-blue-800 mb-2">Customer Information</h4>
                <p className="text-gray-700">{orderData.customer.name}</p>
                <p className="text-gray-600">{orderData.customer.phone}</p>
                <p className="text-gray-600">{orderData.customer.email}</p>
              </div>
              
              <div className="bg-green-50 p-4 rounded-lg">
                <h4 className="font-bold text-green-800 mb-2">Delivery Address</h4>
                <p className="text-gray-700">{orderData.customer.address}</p>
                <p className="text-gray-600">{orderData.customer.upazila}, {orderData.customer.district}</p>
                <p className="text-gray-600">{orderData.customer.division}</p>
              </div>
            </div>
            
            <div className="bg-gray-50 p-4 rounded-lg">
              <h4 className="font-bold text-gray-800 mb-2">Order Summary</h4>
              <div className="space-y-2">
                {orderData.items.map(item => (
                  <div key={item.id} className="flex justify-between">
                    <span>{item.name} x{item.qty}</span>
                    <span className="font-bold">à§³{item.price * item.qty}</span>
                  </div>
                ))}
                <div className="border-t pt-2">
                  <div className="flex justify-between">
                    <span>Subtotal</span>
                    <span>à§³{orderData.items.reduce((sum, item) => sum + (item.price * item.qty), 0)}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Shipping</span>
                    <span>à§³{orderData.shipping.charge}</span>
                  </div>
                  <div className="flex justify-between font-bold text-lg mt-2">
                    <span>Total</span>
                    <span className="text-orange-600">à§³{orderData.payment.amount}</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="bg-yellow-50 p-4 rounded-lg">
              <h4 className="font-bold text-yellow-800 mb-2 flex items-center gap-2">
                <Truck size={20} />
                Delivery Information
              </h4>
              <p className="text-gray-700">
                Estimated delivery: <strong>3-5 working days</strong>
              </p>
              <p className="text-sm text-gray-600">
                We'll contact you before delivery at {orderData.customer.phone}
              </p>
            </div>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
            <button
              onClick={handlePrint}
              className="bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2"
            >
              <Printer size={20} />
              Print Receipt
            </button>
            
            <button
              onClick={handleShare}
              className="bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition flex items-center justify-center gap-2"
            >
              <Share2 size={20} />
              Share Order
            </button>
            
            <button
              onClick={onClose}
              className="bg-gray-600 text-white py-3 rounded-lg font-bold hover:bg-gray-700 transition flex items-center justify-center gap-2"
            >
              <ShoppingBag size={20} />
              Continue Shopping
            </button>
          </div>
          
          <div className="mt-6 pt-6 border-t border-gray-200 text-center">
            <p className="text-sm text-gray-600">
              Need help? Contact us: {ADMIN_NUMBERS.GP} | {OTP_CONFIG.EMAIL.SENDER}
            </p>
            <div className="flex justify-center gap-4 mt-4">
              <a 
                href={`https://wa.me/${ADMIN_NUMBERS.WHATSAPP}`}
                target="_blank"
                rel="noopener noreferrer"
                className="text-green-600 hover:text-green-800 font-medium"
              >
                WhatsApp Support
              </a>
              <a 
                href={SOCIAL_LINKS.EMAIL}
                className="text-blue-600 hover:text-blue-800 font-medium"
              >
                Email Support
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// Admin Dashboard Component
const AdminDashboard = ({ onClose }) => {
  const [products, setProducts] = useState(PRODUCTS);
  const [orders, setOrders] = useState([]);
  const [visitors, setVisitors] = useState([]);
  const [activeTab, setActiveTab] = useState('products');
  const [editingProduct, setEditingProduct] = useState(null);
  const [newProduct, setNewProduct] = useState({
    name: '',
    category: '',
    series: '',
    price: '',
    image: '',
    description: '',
    specs: '',
    warranty: '8 Months',
    stock: true,
    features: []
  });
  
  const [newFeature, setNewFeature] = useState('');
  const [bkashNumber, setBkashNumber] = useState(ADMIN_NUMBERS.GP);
  const [nagadNumber, setNagadNumber] = useState(ADMIN_NUMBERS.GP);
  const [rocketNumber, setRocketNumber] = useState(ADMIN_NUMBERS.GP);
  const [adminPassword, setAdminPassword] = useState('');
  const [currentPassword, setCurrentPassword] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [confirmNewPassword, setConfirmNewPassword] = useState('');

  useEffect(() => {
    // Load orders from localStorage
    const storedOrders = JSON.parse(localStorage.getItem('nova_orders') || '[]');
    setOrders(storedOrders);
    
    // Load visitors from localStorage
    const storedVisitors = JSON.parse(localStorage.getItem('nova_visitors') || '[]');
    setVisitors(storedVisitors);
    
    // Load admin password from localStorage or set default
    const storedPassword = localStorage.getItem('nova_admin_password');
    if (storedPassword) {
      setAdminPassword(storedPassword);
    } else {
      setAdminPassword(DEFAULT_ADMIN_PASSWORD);
      localStorage.setItem('nova_admin_password', DEFAULT_ADMIN_PASSWORD);
    }
    
    // Load products from localStorage
    const storedProducts = JSON.parse(localStorage.getItem('nova_products') || '[]');
    if (storedProducts.length > 0) {
      setProducts(storedProducts);
    }
    
    // Load payment numbers
    const storedBkash = localStorage.getItem('nova_bkash_number');
    const storedNagad = localStorage.getItem('nova_nagad_number');
    const storedRocket = localStorage.getItem('nova_rocket_number');
    
    if (storedBkash) setBkashNumber(storedBkash);
    if (storedNagad) setNagadNumber(storedNagad);
    if (storedRocket) setRocketNumber(storedRocket);
  }, []);

  const handleAddProduct = () => {
    if (!newProduct.name || !newProduct.price) {
      alert('Please fill required fields');
      return;
    }

    const product = {
      id: Date.now(),
      ...newProduct,
      price: parseInt(newProduct.price),
      rating: 4.5,
      features: newProduct.features.length > 0 ? newProduct.features : ['High Quality', '8 Months Warranty']
    };

    const updatedProducts = [...products, product];
    setProducts(updatedProducts);
    
    // Update localStorage
    localStorage.setItem('nova_products', JSON.stringify(updatedProducts));
    
    // Reset form
    setNewProduct({
      name: '',
      category: '',
      series: '',
      price: '',
      image: '',
      description: '',
      specs: '',
      warranty: '8 Months',
      stock: true,
      features: []
    });
    
    alert('Product added successfully!');
  };

  const handleEditProduct = (product) => {
    setEditingProduct(product);
    setNewProduct({
      name: product.name,
      category: product.category,
      series: product.series,
      price: product.price.toString(),
      image: product.image,
      description: product.description,
      specs: product.specs,
      warranty: product.warranty,
      stock: product.stock,
      features: product.features
    });
  };

  const handleUpdateProduct = () => {
    if (!editingProduct) return;

    const updatedProducts = products.map(p => 
      p.id === editingProduct.id 
        ? { ...editingProduct, ...newProduct, price: parseInt(newProduct.price) }
        : p
    );
    
    setProducts(updatedProducts);
    localStorage.setItem('nova_products', JSON.stringify(updatedProducts));
    
    setEditingProduct(null);
    setNewProduct({
      name: '',
      category: '',
      series: '',
      price: '',
      image: '',
      description: '',
      specs: '',
      warranty: '8 Months',
      stock: true,
      features: []
    });
    
    alert('Product updated successfully!');
  };

  const handleDeleteProduct = (id) => {
    if (window.confirm('Are you sure you want to delete this product?')) {
      const updatedProducts = products.filter(p => p.id !== id);
      setProducts(updatedProducts);
      localStorage.setItem('nova_products', JSON.stringify(updatedProducts));
      alert('Product deleted successfully!');
    }
  };

  const handleAddFeature = () => {
    if (newFeature.trim()) {
      setNewProduct(prev => ({
        ...prev,
        features: [...prev.features, newFeature.trim()]
      }));
      setNewFeature('');
    }
  };

  const handleRemoveFeature = (index) => {
    setNewProduct(prev => ({
      ...prev,
      features: prev.features.filter((_, i) => i !== index)
    }));
  };

  const updateOrderStatus = (orderId, status) => {
    const updatedOrders = orders.map(order => 
      order.orderId === orderId ? { ...order, status } : order
    );
    
    setOrders(updatedOrders);
    localStorage.setItem('nova_orders', JSON.stringify(updatedOrders));
    
    // Send status update to customer
    const order = orders.find(o => o.orderId === orderId);
    if (order) {
      const message = `ðŸ“¦ *Order Status Update*\n\nOrder ID: ${orderId}\nStatus: ${status}\n\nThank you for choosing Nova Tech!`;
      const whatsappUrl = `https://wa.me/${formatBangladeshiNumber(order.customer.phone)}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }
    
    alert(`Order ${orderId} status updated to ${status}`);
  };

  const handleChangePassword = () => {
    if (!currentPassword || !newPassword || !confirmNewPassword) {
      alert('Please fill all password fields');
      return;
    }

    if (currentPassword !== adminPassword) {
      alert('Current password is incorrect');
      return;
    }

    if (newPassword !== confirmNewPassword) {
      alert('New passwords do not match');
      return;
    }

    if (newPassword.length < 6) {
      alert('New password must be at least 6 characters');
      return;
    }

    setAdminPassword(newPassword);
    localStorage.setItem('nova_admin_password', newPassword);
    
    setCurrentPassword('');
    setNewPassword('');
    setConfirmNewPassword('');
    
    alert('Password changed successfully!');
  };

  const savePaymentSettings = () => {
    localStorage.setItem('nova_bkash_number', bkashNumber);
    localStorage.setItem('nova_nagad_number', nagadNumber);
    localStorage.setItem('nova_rocket_number', rocketNumber);
    alert('Payment settings saved successfully!');
  };

  const renderProductsTab = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-xl shadow p-6">
        <h3 className="text-xl font-bold text-gray-800 mb-4">
          {editingProduct ? 'Edit Product' : 'Add New Product'}
        </h3>
        
        <div className="grid md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Product Name *</label>
            <input
              type="text"
              value={newProduct.name}
              onChange={(e) => setNewProduct(prev => ({ ...prev, name: e.target.value }))}
              className="w-full px-4 py-2 border rounded-lg"
              placeholder="Nova Fast Charger 33W"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Category</label>
            <select
              value={newProduct.category}
              onChange={(e) => setNewProduct(prev => ({ ...prev, category: e.target.value }))}
              className="w-full px-4 py-2 border rounded-lg"
            >
              <option value="">Select Category</option>
              <option value="chargers">Chargers</option>
              <option value="lights">LED Lights</option>
              <option value="batteries">Batteries</option>
              <option value="accessories">Accessories</option>
            </select>
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Price (à§³) *</label>
            <input
              type="number"
              value={newProduct.price}
              onChange={(e) => setNewProduct(prev => ({ ...prev, price: e.target.value }))}
              className="w-full px-4 py-2 border rounded-lg"
              placeholder="450"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
            <input
              type="text"
              value={newProduct.image}
              onChange={(e) => setNewProduct(prev => ({ ...prev, image: e.target.value }))}
              className="w-full px-4 py-2 border rounded-lg"
              placeholder="https://images.unsplash.com/photo-..."
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea
              value={newProduct.description}
              onChange={(e) => setNewProduct(prev => ({ ...prev, description: e.target.value }))}
              className="w-full px-4 py-2 border rounded-lg"
              rows="3"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Specifications</label>
            <input
              type="text"
              value={newProduct.specs}
              onChange={(e) => setNewProduct(prev => ({ ...prev, specs: e.target.value }))}
              className="w-full px-4 py-2 border rounded-lg"
              placeholder="33W QC 3.0, Type-C"
            />
          </div>
        </div>
        
        <div className="mt-4">
          <label className="block text-sm font-medium text-gray-700 mb-2">Features</label>
          <div className="flex gap-2 mb-2">
            <input
              type="text"
              value={newFeature}
              onChange={(e) => setNewFeature(e.target.value)}
              className="flex-1 px-4 py-2 border rounded-lg"
              placeholder="Add a feature"
              onKeyPress={(e) => e.key === 'Enter' && handleAddFeature()}
            />
            <button
              onClick={handleAddFeature}
              className="bg-blue-600 text-white px-4 py-2 rounded-lg"
            >
              Add
            </button>
          </div>
          <div className="flex flex-wrap gap-2">
            {newProduct.features.map((feature, index) => (
              <span key={index} className="bg-gray-100 px-3 py-1 rounded-full text-sm flex items-center gap-1">
                {feature}
                <button
                  onClick={() => handleRemoveFeature(index)}
                  className="text-red-500 hover:text-red-700"
                >
                  <X size={14} />
                </button>
              </span>
            ))}
          </div>
        </div>
        
        <div className="mt-6 flex gap-3">
          <button
            onClick={editingProduct ? handleUpdateProduct : handleAddProduct}
            className="bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700"
          >
            {editingProduct ? 'Update Product' : 'Add Product'}
          </button>
          
          {editingProduct && (
            <button
              onClick={() => {
                setEditingProduct(null);
                setNewProduct({
                  name: '',
                  category: '',
                  series: '',
                  price: '',
                  image: '',
                  description: '',
                  specs: '',
                  warranty: '8 Months',
                  stock: true,
                  features: []
                });
              }}
              className="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-700"
            >
              Cancel
            </button>
          )}
        </div>
      </div>

      <div className="bg-white rounded-xl shadow overflow-hidden">
        <h3 className="text-xl font-bold text-gray-800 p-6 border-b">All Products ({products.length})</h3>
        
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Product</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Category</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Price</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Stock</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {products.map(product => (
                <tr key={product.id}>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <img src={product.image} alt={product.name} className="w-12 h-12 object-cover rounded" />
                      <div>
                        <p className="font-medium">{product.name}</p>
                        <p className="text-sm text-gray-600">{product.series}</p>
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="capitalize">{product.category}</span>
                  </td>
                  <td className="px-6 py-4 font-bold">à§³{product.price}</td>
                  <td className="px-6 py-4">
                    <span className={`px-3 py-1 rounded-full text-sm ${product.stock ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                      {product.stock ? 'In Stock' : 'Out of Stock'}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex gap-2">
                      <button
                        onClick={() => handleEditProduct(product)}
                        className="text-blue-600 hover:text-blue-800"
                      >
                        <Edit size={18} />
                      </button>
                      <button
                        onClick={() => handleDeleteProduct(product.id)}
                        className="text-red-600 hover:text-red-800"
                      >
                        <Trash2 size={18} />
                      </button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );

  const renderOrdersTab = () => (
    <div className="space-y-6">
      <div className="grid md:grid-cols-4 gap-4">
        <div className="bg-blue-50 p-4 rounded-xl">
          <div className="text-3xl font-bold text-blue-700">{orders.length}</div>
          <div className="text-sm text-blue-600">Total Orders</div>
        </div>
        
        <div className="bg-green-50 p-4 rounded-xl">
          <div className="text-3xl font-bold text-green-700">
            {orders.filter(o => o.status === 'delivered').length}
          </div>
          <div className="text-sm text-green-600">Delivered</div>
        </div>
        
        <div className="bg-orange-50 p-4 rounded-xl">
          <div className="text-3xl font-bold text-orange-700">
            {orders.filter(o => o.status === 'processing').length}
          </div>
          <div className="text-sm text-orange-600">Processing</div>
        </div>
        
        <div className="bg-red-50 p-4 rounded-xl">
          <div className="text-3xl font-bold text-red-700">
            {orders.filter(o => o.status === 'cancelled').length}
          </div>
          <div className="text-sm text-red-600">Cancelled</div>
        </div>
      </div>

      <div className="bg-white rounded-xl shadow overflow-hidden">
        <h3 className="text-xl font-bold text-gray-800 p-6 border-b">Recent Orders</h3>
        
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Order ID</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Customer</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Amount</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Status</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Date</th>
                <th className="px-6 py-3 text-left text-sm font-medium text-gray-700">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {orders.map(order => (
                <tr key={order.orderId}>
                  <td className="px-6 py-4 font-mono text-sm">{order.orderId}</td>
                  <td className="px-6 py-4">
                    <div>
                      <p className="font-medium">{order.customer.name}</p>
                      <p className="text-sm text-gray-600">{order.customer.phone}</p>
                    </div>
                  </td>
                  <td className="px-6 py-4 font-bold">à§³{order.payment.amount}</td>
                  <td className="px-6 py-4">
                    <select
                      value={order.status}
                      onChange={(e) => updateOrderStatus(order.orderId, e.target.value)}
                      className="px-3 py-1 border rounded text-sm"
                    >
                      <option value="processing">Processing</option>
                      <option value="confirmed">Confirmed</option>
                      <option value="shipped">Shipped</option>
                      <option value="delivered">Delivered</option>
                      <option value="cancelled">Cancelled</option>
                    </select>
                  </td>
                  <td className="px-6 py-4 text-sm">
                    {new Date(order.date).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <button
                      onClick={() => {
                        const message = `ðŸ“¦ *Order Details*\n\nOrder ID: ${order.orderId}\nCustomer: ${order.customer.name}\nPhone: ${order.customer.phone}\nAmount: à§³${order.payment.amount}\nStatus: ${order.status}\n\nDelivery Address:\n${order.customer.address}\n${order.customer.upazila}, ${order.customer.district}`;
                        const whatsappUrl = `https://wa.me/${ADMIN_NUMBERS.WHATSAPP}?text=${encodeURIComponent(message)}`;
                        window.open(whatsappUrl, '_blank');
                      }}
                      className="text-green-600 hover:text-green-800"
                    >
                      <MessageCircle size={18} />
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );

  const renderVisitorsTab = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-xl shadow p-6">
        <h3 className="text-xl font-bold text-gray-800 mb-4">Visitors Statistics</h3>
        
        <div className="grid md:grid-cols-3 gap-6">
          <div className="bg-blue-50 p-6 rounded-xl">
            <div className="text-4xl font-bold text-blue-700">{visitors.length}</div>
            <div className="text-blue-600">Total Visitors</div>
          </div>
          
          <div className="bg-green-50 p-6 rounded-xl">
            <div className="text-4xl font-bold text-green-700">
              {[...new Set(visitors.map(v => v.division))].length}
            </div>
            <div className="text-green-600">Divisions Covered</div>
          </div>
          
          <div className="bg-orange-50 p-6 rounded-xl">
            <div className="text-4xl font-bold text-orange-700">
              {[...new Set(visitors.map(v => v.district))].length}
            </div>
            <div className="text-orange-600">Districts Covered</div>
          </div>
        </div>
        
        <div className="mt-8">
          <h4 className="font-bold text-gray-800 mb-3">Recent Visitors</h4>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Name</th>
                  <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Location</th>
                  <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Contact</th>
                  <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Date</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {visitors.slice(-10).reverse().map(visitor => (
                  <tr key={visitor.id}>
                    <td className="px-4 py-3">
                      <div>
                        <p className="font-medium">{visitor.name}</p>
                        <p className="text-xs text-gray-600">Visitor #{visitor.visitorNumber}</p>
                      </div>
                    </td>
                    <td className="px-4 py-3">
                      <p className="text-sm">{visitor.district}, {visitor.division}</p>
                      <p className="text-xs text-gray-600">{visitor.location}</p>
                    </td>
                    <td className="px-4 py-3">
                      <p className="text-sm">{visitor.whatsapp}</p>
                      <p className="text-xs text-gray-600">{visitor.email}</p>
                    </td>
                    <td className="px-4 py-3 text-sm">
                      {new Date(visitor.timestamp).toLocaleDateString()}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  );

  const renderSettingsTab = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-xl shadow p-6">
        <h3 className="text-xl font-bold text-gray-800 mb-6">Payment Settings</h3>
        
        <div className="space-y-6">
          <div>
            <h4 className="font-bold text-gray-700 mb-3">Mobile Banking Numbers</h4>
            <div className="grid md:grid-cols-3 gap-4">
              <div className="border rounded-lg p-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">bKash Number</label>
                <input
                  type="text"
                  value={bkashNumber}
                  onChange={(e) => setBkashNumber(e.target.value)}
                  className="w-full px-4 py-2 border rounded-lg"
                  placeholder="01XXXXXXXXX"
                />
              </div>
              
              <div className="border rounded-lg p-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">Nagad Number</label>
                <input
                  type="text"
                  value={nagadNumber}
                  onChange={(e) => setNagadNumber(e.target.value)}
                  className="w-full px-4 py-2 border rounded-lg"
                  placeholder="01XXXXXXXXX"
                />
              </div>
              
              <div className="border rounded-lg p-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">Rocket Number</label>
                <input
                  type="text"
                  value={rocketNumber}
                  onChange={(e) => setRocketNumber(e.target.value)}
                  className="w-full px-4 py-2 border rounded-lg"
                  placeholder="01XXXXXXXXX"
                />
              </div>
            </div>
          </div>
          
          <div>
            <h4 className="font-bold text-gray-700 mb-3">Bank Account Information</h4>
            <div className="grid md:grid-cols-2 gap-4">
              <div className="border rounded-lg p-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">Bank Name</label>
                <input
                  type="text"
                  value="Bank Asia Limited"
                  className="w-full px-4 py-2 border rounded-lg bg-gray-50"
                  readOnly
                />
              </div>
              
              <div className="border rounded-lg p-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">Account Number</label>
                <input
                  type="text"
                  value="5031070007530"
                  className="w-full px-4 py-2 border rounded-lg bg-gray-50"
                  readOnly
                />
              </div>
              
              <div className="border rounded-lg p-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">Account Name</label>
                <input
                  type="text"
                  value="NOVA TECH BD"
                  className="w-full px-4 py-2 border rounded-lg bg-gray-50"
                  readOnly
                />
              </div>
              
              <div className="border rounded-lg p-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">Branch</label>
                <input
                  type="text"
                  value="Motijheel"
                  className="w-full px-4 py-2 border rounded-lg bg-gray-50"
                  readOnly
                />
              </div>
            </div>
          </div>
          
          <div className="border rounded-lg p-4">
            <h4 className="font-bold text-gray-700 mb-3">SSLCOMMERZ Settings</h4>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Store ID</label>
                <input
                  type="text"
                  value="novatech"
                  className="w-full px-4 py-2 border rounded-lg bg-gray-50"
                  readOnly
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">API Credentials</label>
                <div className="text-sm text-gray-600">
                  <p>For SSLCOMMERZ integration, you need to:</p>
                  <ol className="list-decimal ml-5 mt-2 space-y-1">
                    <li>Register at SSLCOMMERZ Merchant Panel</li>
                    <li>Get Store ID & Password from SSLCOMMERZ</li>
                    <li>Configure Success/Fail URLs</li>
                    <li>Integrate with Backend API</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
          
          <button
            onClick={savePaymentSettings}
            className="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700"
          >
            Save Payment Settings
          </button>
        </div>
      </div>

      <div className="bg-white rounded-xl shadow p-6">
        <h3 className="text-xl font-bold text-gray-800 mb-6">Change Admin Password</h3>
        
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
            <input
              type="password"
              value={currentPassword}
              onChange={(e) => setCurrentPassword(e.target.value)}
              className="w-full px-4 py-2 border rounded-lg"
              placeholder="Enter current password"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">New Password</label>
            <input
              type="password"
              value={newPassword}
              onChange={(e) => setNewPassword(e.target.value)}
              className="w-full px-4 py-2 border rounded-lg"
              placeholder="Enter new password (min 6 characters)"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Confirm New Password</label>
            <input
              type="password"
              value={confirmNewPassword}
              onChange={(e) => setConfirmNewPassword(e.target.value)}
              className="w-full px-4 py-2 border rounded-lg"
              placeholder="Confirm new password"
            />
          </div>
          
          <button
            onClick={handleChangePassword}
            className="bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700"
          >
            Change Password
          </button>
        </div>
      </div>
    </div>
  );

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
      <div className="bg-white rounded-2xl max-w-6xl w-full shadow-2xl my-8 max-h-[90vh] overflow-hidden flex flex-col">
        <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6">
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                <Settings size={24} />
              </div>
              <div>
                <h2 className="text-xl font-bold">Admin Dashboard</h2>
                <p className="text-blue-100 text-sm">Manage your Nova Tech store</p>
              </div>
            </div>
            <button
              onClick={onClose}
              className="text-white hover:text-blue-200"
            >
              <X size={24} />
            </button>
          </div>
        </div>
        
        <div className="border-b">
          <div className="flex overflow-x-auto">
            <button
              onClick={() => setActiveTab('products')}
              className={`px-6 py-4 font-medium whitespace-nowrap ${activeTab === 'products' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}
            >
              <Package size={20} className="inline mr-2" />
              Products
            </button>
            <button
              onClick={() => setActiveTab('orders')}
              className={`px-6 py-4 font-medium whitespace-nowrap ${activeTab === 'orders' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}
            >
              <ShoppingBag size={20} className="inline mr-2" />
              Orders ({orders.length})
            </button>
            <button
              onClick={() => setActiveTab('visitors')}
              className={`px-6 py-4 font-medium whitespace-nowrap ${activeTab === 'visitors' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}
            >
              <Users size={20} className="inline mr-2" />
              Visitors ({visitors.length})
            </button>
            <button
              onClick={() => setActiveTab('settings')}
              className={`px-6 py-4 font-medium whitespace-nowrap ${activeTab === 'settings' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}
            >
              <CreditCard size={20} className="inline mr-2" />
              Settings
            </button>
          </div>
        </div>
        
        <div className="flex-1 overflow-y-auto p-6">
          {activeTab === 'products' && renderProductsTab()}
          {activeTab === 'orders' && renderOrdersTab()}
          {activeTab === 'visitors' && renderVisitorsTab()}
          {activeTab === 'settings' && renderSettingsTab()}
        </div>
        
        <div className="border-t p-4 bg-gray-50">
          <div className="flex justify-between items-center">
            <div className="text-sm text-gray-600">
              Last updated: {new Date().toLocaleDateString()}
            </div>
            <div className="flex gap-3">
              <button
                onClick={() => window.print()}
                className="flex items-center gap-2 text-gray-600 hover:text-gray-800"
              >
                <Printer size={18} />
                Print Report
              </button>
              <button
                onClick={() => {
                  const data = {
                    products,
                    orders,
                    visitors
                  };
                  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = `nova-tech-data-${new Date().toISOString().split('T')[0]}.json`;
                  document.body.appendChild(a);
                  a.click();
                  document.body.removeChild(a);
                  URL.revokeObjectURL(url);
                }}
                className="flex items-center gap-2 text-blue-600 hover:text-blue-800"
              >
                <Download size={18} />
                Export Data
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// Header Component
const Header = ({ cartCount, onCartClick, onMenuToggle, isMenuOpen, onDealerLogin, onAdminAccess }) => {
  const [scrolled, setScrolled] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      setScrolled(window.scrollY > 10);
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  return (
    <header className={`sticky top-0 z-50 transition-all duration-300 ${scrolled ? 'bg-white/95 backdrop-blur-md shadow-lg' : 'bg-white shadow-md'}`}>
      <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white py-2 px-4">
        <div className="container mx-auto flex justify-between items-center">
          <div className="flex items-center gap-3">
            <div className="flex items-center gap-2">
              <div className="flex items-center gap-1">
                <Mail size={14} />
                <MessageCircle size={14} />
              </div>
              <span className="text-sm font-medium">
                Dual OTP System: Email & WhatsApp
              </span>
            </div>
          </div>
          
          <div className="flex items-center gap-3">
            <div className="hidden sm:flex items-center gap-2">
              <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
              <span className="text-sm">Secure OTP Active</span>
            </div>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-3 flex justify-between items-center">
        <div className="flex items-center gap-2 group cursor-pointer">
          <div className="relative">
            <Zap className="text-orange-500 group-hover:rotate-12 transition-transform" size={28} />
            <div className="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full animate-ping"></div>
          </div>
          <div>
            <span className="text-xl font-bold text-blue-700">NOVA TECH</span>
            <span className="text-sm text-gray-500 hidden sm:inline ml-1">[BD]</span>
            <p className="text-xs text-gray-500">Dual OTP Verified</p>
          </div>
        </div>

        <div className="flex items-center gap-4">
          <div className="hidden md:flex items-center gap-2 bg-gradient-to-r from-blue-50 to-green-50 px-3 py-1 rounded-full border">
            <div className="flex items-center gap-1">
              <Mail size={14} className="text-blue-600" />
              <MessageCircle size={14} className="text-green-600" />
            </div>
            <span className="text-sm font-medium text-gray-700">Email & WhatsApp OTP</span>
          </div>
          
          <button
            onClick={onDealerLogin}
            className="hidden md:flex items-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all text-sm font-bold"
          >
            <Users size={16} />
            Dealer Login
          </button>
          
          <div 
            className="relative cursor-pointer group"
            onClick={onCartClick}
          >
            <ShoppingCart className="text-gray-600 hover:text-blue-700 transition-colors" size={24} />
            {cartCount > 0 && (
              <span className="absolute -top-2 -right-2 bg-orange-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-bounce">
                {cartCount}
              </span>
            )}
          </div>
          
          <button 
            className="lg:hidden"
            onClick={onMenuToggle}
          >
            {isMenuOpen ? <X size={24} /> : <Menu size={24} />}
          </button>
        </div>
      </div>

      {isMenuOpen && (
        <div className="lg:hidden bg-white border-t animate-slideDown">
          <div className="container mx-auto px-4 py-3 flex flex-col gap-2">
            <div className="flex gap-3 mb-4 justify-center">
              <a 
                href={SOCIAL_LINKS.FACEBOOK}
                target="_blank"
                rel="noopener noreferrer"
                className="bg-blue-100 text-blue-600 p-2 rounded-full hover:bg-blue-200"
              >
                <Facebook size={20} />
              </a>
              <a 
                href={SOCIAL_LINKS.YOUTUBE}
                target="_blank"
                rel="noopener noreferrer"
                className="bg-red-100 text-red-600 p-2 rounded-full hover:bg-red-200"
              >
                <Youtube size={20} />
              </a>
              <a 
                href={`https://wa.me/${ADMIN_NUMBERS.WHATSAPP}`}
                target="_blank"
                rel="noopener noreferrer"
                className="bg-green-100 text-green-600 p-2 rounded-full hover:bg-green-200"
              >
                <MessageCircle size={20} />
              </a>
            </div>
            
            <a href="#home" className="py-2 px-4 hover:bg-blue-50 rounded-lg font-medium">Home</a>
            <a href="#products" className="py-2 px-4 hover:bg-blue-50 rounded-lg font-medium">Products</a>
            <a href="#contact" className="py-2 px-4 hover:bg-blue-50 rounded-lg font-medium">Contact</a>
            
            <button
              onClick={onDealerLogin}
              className="py-2 px-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-bold hover:from-orange-600 hover:to-orange-700 transition-all flex items-center justify-center gap-2"
            >
              <Users size={16} />
              Dealer Login (Dual OTP)
            </button>
            
            <div className="pt-4 border-t">
              <div className="grid grid-cols-2 gap-2 mb-2">
                <a 
                  href={SOCIAL_LINKS.EMAIL}
                  className="bg-blue-600 text-white py-2 px-4 rounded-lg text-center font-bold flex items-center justify-center gap-2"
                >
                  <Mail size={16} /> Email OTP
                </a>
                <a 
                  href={`https://wa.me/${ADMIN_NUMBERS.WHATSAPP}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="bg-green-600 text-white py-2 px-4 rounded-lg text-center font-bold flex items-center justify-center gap-2"
                >
                  <MessageCircle size={16} /> WhatsApp OTP
                </a>
              </div>
              <a 
                href={SOCIAL_LINKS.PHONE}
                className="block bg-gray-700 text-white py-2 px-4 rounded-lg text-center font-bold"
              >
                <Phone size={16} className="inline mr-2" /> Call: {ADMIN_NUMBERS.GP}
              </a>
            </div>
          </div>
        </div>
      )}
    </header>
  );
};

// Footer Component
const Footer = () => (
  <footer className="bg-slate-900 text-slate-300 pt-12 pb-8">
    <div className="container mx-auto px-4">
      <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
        <div>
          <div className="flex items-center gap-2 text-white font-bold text-xl mb-4">
            <Zap className="text-orange-500" /> NOVA TECH
          </div>
          <p className="text-slate-400 mb-6">
            Dual OTP verification system with Email and WhatsApp support.
            Secure dealer authentication for Bangladesh's trusted electronics brand.
          </p>
          <div className="flex gap-3">
            <a 
              href={SOCIAL_LINKS.FACEBOOK}
              target="_blank"
              rel="noopener noreferrer"
              className="text-slate-400 hover:text-white transition-colors p-2 bg-slate-800 rounded-full hover:bg-blue-600"
              title="Facebook"
            >
              <Facebook size={20} />
            </a>
            <a 
              href={SOCIAL_LINKS.EMAIL}
              className="text-slate-400 hover:text-white transition-colors p-2 bg-slate-800 rounded-full hover:bg-blue-500"
              title="Email OTP"
            >
              <Mail size={20} />
            </a>
            <a 
              href={`https://wa.me/${ADMIN_NUMBERS.WHATSAPP}`}
              target="_blank"
              rel="noopener noreferrer"
              className="text-slate-400 hover:text-white transition-colors p-2 bg-slate-800 rounded-full hover:bg-green-600"
              title="WhatsApp OTP"
            >
              <MessageCircle size={20} />
            </a>
          </div>
        </div>
        
        <div>
          <h4 className="text-white font-bold mb-4">Dual OTP System</h4>
          <div className="space-y-3">
            <div className="flex items-center gap-2">
              <Mail size={16} className="text-blue-400" />
              <div>
                <span className="text-slate-300">Email OTP:</span>
                <a 
                  href={SOCIAL_LINKS.EMAIL}
                  className="block text-blue-400 hover:text-blue-300"
                >
                  {OTP_CONFIG.EMAIL.SENDER}
                </a>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <MessageCircle size={16} className="text-green-400" />
              <div>
                <span className="text-slate-300">WhatsApp OTP:</span>
                <a 
                  href={`https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="block text-green-400 hover:text-green-300"
                >
                  {OTP_CONFIG.WHATSAPP.SENDER_NUMBER}
                </a>
              </div>
            </div>
            <div className="pt-2">
              <p className="text-sm text-slate-400">Choose your preferred OTP method</p>
            </div>
          </div>
        </div>

        <div>
          <h4 className="text-white font-bold mb-4">Security Features</h4>
          <ul className="space-y-2 text-sm text-slate-400">
            <li className="flex items-center gap-2">
              <Mail size={14} className="text-blue-500" />
              Email OTP Verification
            </li>
            <li className="flex items-center gap-2">
              <MessageCircle size={14} className="text-green-500" />
              WhatsApp OTP Verification
            </li>
            <li className="flex items-center gap-2">
              <CheckCircle size={14} className="text-green-500" />
              Auto-detection System
            </li>
            <li className="flex items-center gap-2">
              <ShieldCheck size={14} className="text-green-500" />
              Encrypted Communication
            </li>
          </ul>
        </div>

        <div>
          <h4 className="text-white font-bold mb-4">Quick Links</h4>
          <ul className="space-y-2 text-sm text-slate-400">
            <li><a href="#home" className="hover:text-orange-400 transition-colors">Home</a></li>
            <li><a href="#products" className="hover:text-orange-400 transition-colors">Products</a></li>
            <li><a href="#contact" className="hover:text-orange-400 transition-colors">Contact</a></li>
            <li><a href="#dealer" className="hover:text-orange-400 transition-colors">Dealer Login</a></li>
            <li><a href="#otp-system" className="hover:text-orange-400 transition-colors">Dual OTP System</a></li>
          </ul>
        </div>
      </div>

      <div className="border-t border-slate-800 pt-8 text-center">
        <p>&copy; {new Date().getFullYear()} Nova Tech [BD]. All rights reserved.</p>
        <p className="text-slate-500 text-sm mt-2">
          Dual OTP Verification System | Total Visitors: {getVisitorCount()}
          <a 
            href={SOCIAL_LINKS.EMAIL}
            className="text-blue-400 hover:text-blue-300 ml-2"
          >
            Email OTP: {OTP_CONFIG.EMAIL.SENDER}
          </a> | 
          <a 
            href={`https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}`}
            target="_blank"
            rel="noopener noreferrer"
            className="text-green-400 hover:text-green-300 ml-2"
          >
            WhatsApp OTP: {OTP_CONFIG.WHATSAPP.SENDER_NUMBER}
          </a>
        </p>
      </div>
    </div>
  </footer>
);

// Contact Section
const ContactSection = () => (
  <section id="contact" className="py-16 bg-white">
    <div className="container mx-auto px-4">
      <div className="bg-gradient-to-r from-blue-600 via-green-600 to-blue-600 text-white rounded-2xl p-8 shadow-2xl">
        <div className="text-center mb-8">
          <h2 className="text-3xl font-bold mb-4">Dual OTP System & Support</h2>
          <p className="text-blue-100">Choose Email or WhatsApp for OTP verification</p>
        </div>
        
        <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
          <div className="bg-white/10 p-6 rounded-xl backdrop-blur-sm">
            <div className="flex items-center gap-3 mb-4">
              <div className="bg-white/20 p-3 rounded-full">
                <Mail size={24} />
              </div>
              <div>
                <h3 className="font-bold text-lg">Email OTP Login</h3>
                <p className="text-blue-200">Secure email authentication</p>
              </div>
            </div>
            <a 
              href="#dealer"
              className="inline-block bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold shadow-lg hover:shadow-xl transition-all w-full text-center"
            >
              <Mail size={20} className="inline mr-2" /> Email Login
            </a>
          </div>

          <div className="bg-white/10 p-6 rounded-xl backdrop-blur-sm">
            <div className="flex items-center gap-3 mb-4">
              <div className="bg-white/20 p-3 rounded-full">
                <MessageCircle size={24} />
              </div>
              <div>
                <h3 className="font-bold text-lg">WhatsApp OTP Login</h3>
                <p className="text-blue-200">Secure WhatsApp authentication</p>
              </div>
            </div>
            <a 
              href="#dealer"
              className="inline-block bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-bold shadow-lg hover:shadow-xl transition-all w-full text-center"
            >
              <MessageCircle size={20} className="inline mr-2" /> WhatsApp Login
            </a>
          </div>

          <div className="bg-white/10 p-6 rounded-xl backdrop-blur-sm">
            <div className="flex items-center gap-3 mb-4">
              <div className="bg-white/20 p-3 rounded-full">
                <Mail size={24} />
              </div>
              <div>
                <h3 className="font-bold text-lg">Email Support</h3>
                <p className="text-blue-200">{OTP_CONFIG.EMAIL.SENDER}</p>
              </div>
            </div>
            <a 
              href={SOCIAL_LINKS.EMAIL}
              className="inline-block bg-white text-blue-700 hover:bg-blue-50 px-6 py-3 rounded-lg font-bold shadow-lg hover:shadow-xl transition-all w-full text-center"
            >
              <Mail size={20} className="inline mr-2" /> Send Email
            </a>
          </div>

          <div className="bg-white/10 p-6 rounded-xl backdrop-blur-sm">
            <div className="flex items-center gap-3 mb-4">
              <div className="bg-white/20 p-3 rounded-full">
                <MessageCircle size={24} />
              </div>
              <div>
                <h3 className="font-bold text-lg">WhatsApp Support</h3>
                <p className="text-blue-200">{OTP_CONFIG.WHATSAPP.SENDER_NUMBER}</p>
              </div>
            </div>
            <a 
              href={`https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}`}
              target="_blank"
              rel="noopener noreferrer"
              className="inline-block bg-white text-green-700 hover:bg-green-50 px-6 py-3 rounded-lg font-bold shadow-lg hover:shadow-xl transition-all w-full text-center"
            >
              <MessageCircle size={20} className="inline mr-2" /> Chat on WhatsApp
            </a>
          </div>
        </div>

        <div className="mt-8 p-6 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl">
          <div className="flex items-center justify-center gap-4 mb-4">
            <div className="bg-white p-3 rounded-full shadow-lg">
              <div className="flex items-center gap-2">
                <Mail className="text-blue-600" size={24} />
                <span className="text-gray-700">+</span>
                <MessageCircle className="text-green-600" size={24} />
              </div>
            </div>
            <div>
              <h4 className="font-bold text-xl text-gray-800">Dual OTP System</h4>
              <p className="text-gray-700">
                System automatically detects your input and sends OTP accordingly
              </p>
            </div>
          </div>
          <div className="text-center">
            <p className="text-sm text-gray-600">
              Enter email â†’ OTP via Email | Enter mobile â†’ OTP via WhatsApp
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
);

// Floating Action Buttons
const FloatingActionButtons = ({ cart, onCartClick, onDealerLogin, onCheckout }) => (
  <div className="fixed bottom-6 right-6 flex flex-col gap-4 z-50">
    <button
      onClick={onDealerLogin}
      className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-full shadow-xl hover:from-blue-600 hover:to-blue-700 transition-all animate-pulse hover:scale-110"
      title="Dual OTP Login"
    >
      <Mail size={24} />
    </button>
    
    <button
      onClick={onCartClick}
      className="bg-orange-500 text-white p-4 rounded-full shadow-xl hover:bg-orange-600 transition-all hover:scale-110 relative"
      title="View Cart"
    >
      <ShoppingCart size={24} />
      {cart.length > 0 && (
        <span className="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center animate-bounce">
          {cart.reduce((sum, item) => sum + item.qty, 0)}
        </span>
      )}
    </button>

    <button
      onClick={onDealerLogin}
      className="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-full shadow-xl hover:from-green-600 hover:to-green-700 transition-all hover:scale-110"
      title="WhatsApp OTP"
    >
      <MessageCircle size={24} />
    </button>

    <a
      href={SOCIAL_LINKS.PHONE}
      className="bg-gray-700 text-white p-4 rounded-full shadow-xl hover:bg-gray-800 transition-all hover:scale-110"
      title="Call Support"
    >
      <Phone size={24} />
    </a>
  </div>
);

// Hero Section
const Hero = ({ onDealerLogin }) => (
  <div id="home" className="relative bg-gradient-to-r from-blue-900 via-green-800 to-blue-900 text-white overflow-hidden">
    <div className="container mx-auto px-4 py-16 sm:py-24 relative">
      <div className="max-w-3xl">
        <span className="inline-flex items-center bg-gradient-to-r from-orange-500 to-orange-600 text-white text-sm font-bold px-4 py-2 rounded-full mb-6 animate-pulse">
          <div className="flex items-center gap-1">
            <Mail size={14} />
            <MessageCircle size={14} />
          </div>
          <span className="ml-2">Dual OTP Verification System</span>
        </span>
        
        <h1 className="text-4xl sm:text-5xl md:text-6xl font-bold mb-6 leading-tight">
          Secure Login with{' '}
          <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-green-400">
            Dual OTP System
          </span>
        </h1>
        
        <p className="text-xl text-blue-100 mb-10 max-w-2xl">
          Bangladesh's first dual OTP verification system. 
          Choose Email or WhatsApp for secure dealer authentication.
          Automatic detection based on your input.
        </p>
        
        <div className="flex flex-wrap gap-4 mb-12">
          <button
            onClick={onDealerLogin}
            className="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-8 py-4 rounded-xl font-bold hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg hover:shadow-xl text-lg flex items-center gap-2"
          >
            <div className="flex items-center gap-1">
              <Mail size={20} />
              <span className="mx-1">/</span>
              <MessageCircle size={20} />
            </div>
            Dealer Login (Dual OTP)
          </button>
          <a 
            href="#products"
            className="bg-transparent border-2 border-white text-white px-8 py-4 rounded-xl font-bold hover:bg-white hover:text-blue-900 transition-all text-lg flex items-center gap-2"
          >
            <ShoppingCart size={20} /> Shop Products
          </a>
        </div>
        
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
          <div className="flex items-center gap-3 mb-3">
            <div className="flex items-center gap-1">
              <Mail className="text-blue-400" size={24} />
              <MessageCircle className="text-green-400" size={24} />
            </div>
            <h3 className="text-xl font-bold">How Dual OTP Works</h3>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="text-center p-4 bg-blue-500/20 rounded-lg">
              <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                <Mail size={24} />
              </div>
              <h4 className="font-bold mb-1">Email OTP</h4>
              <p className="text-sm">Enter email â†’ OTP sent via Email</p>
              <p className="text-xs text-blue-200 mt-1">From: {OTP_CONFIG.EMAIL.SENDER}</p>
            </div>
            
            <div className="text-center p-4 bg-green-500/20 rounded-lg">
              <div className="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-2">
                <MessageCircle size={24} />
              </div>
              <h4 className="font-bold mb-1">WhatsApp OTP</h4>
              <p className="text-sm">Enter mobile â†’ OTP sent via WhatsApp</p>
              <p className="text-xs text-green-200 mt-1">From: {OTP_CONFIG.WHATSAPP.SENDER_NUMBER}</p>
            </div>
          </div>
        </div>
        
        <div className="flex gap-4 items-center">
          <span className="text-blue-200">Connect with us:</span>
          <div className="flex gap-3">
            <a 
              href={SOCIAL_LINKS.FACEBOOK}
              target="_blank"
              rel="noopener noreferrer"
              className="bg-white/10 hover:bg-white/20 p-2 rounded-full transition-colors"
              title="Facebook"
            >
              <Facebook size={20} />
            </a>
            <a 
              href={SOCIAL_LINKS.EMAIL}
              className="bg-white/10 hover:bg-white/20 p-2 rounded-full transition-colors"
              title="Email"
            >
              <Mail size={20} />
            </a>
            <a 
              href={`https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}`}
              target="_blank"
              rel="noopener noreferrer"
              className="bg-white/10 hover:bg-white/20 p-2 rounded-full transition-colors"
              title="WhatsApp"
            >
              <MessageCircle size={20} />
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
);

// Products Section
const ProductsSection = ({ onAddToCart }) => (
  <section id="products" className="py-16 bg-gray-50">
    <div className="container mx-auto px-4">
      <div className="text-center mb-12">
        <h2 className="text-3xl font-bold text-blue-900 mb-4">Our Products</h2>
        <p className="text-gray-600 max-w-2xl mx-auto">
          High-quality electronics with 8-month warranty. Order via Email or WhatsApp.
        </p>
      </div>
      
      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {(() => {
          const products = JSON.parse(localStorage.getItem('nova_products') || '[]');
          const displayProducts = products.length > 0 ? products : PRODUCTS;
          
          return displayProducts.map(product => (
            <div key={product.id} className="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-shadow">
              <div className="relative">
                <img 
                  src={product.image} 
                  alt={product.name}
                  className="w-full h-64 object-cover"
                />
                {product.stock && (
                  <span className="absolute top-4 left-4 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                    In Stock
                  </span>
                )}
              </div>
              
              <div className="p-6">
                <div className="flex justify-between items-start mb-2">
                  <h3 className="text-xl font-bold text-gray-800">{product.name}</h3>
                  <span className="text-lg font-bold text-orange-500">à§³{product.price}</span>
                </div>
                
                <div className="flex items-center mb-4">
                  <div className="flex text-yellow-400">
                    {[...Array(5)].map((_, i) => (
                      <Star key={i} size={16} fill={i < Math.floor(product.rating) ? "currentColor" : "none"} />
                    ))}
                  </div>
                  <span className="text-sm text-gray-600 ml-2">{product.rating}</span>
                  <span className="text-sm text-green-600 ml-4">
                    <ShieldCheck size={16} className="inline mr-1" />
                    {product.warranty} Warranty
                  </span>
                </div>
                
                <p className="text-gray-600 mb-4">{product.description}</p>
                
                <div className="mb-4">
                  <h4 className="font-bold text-gray-700 mb-2">Key Features:</h4>
                  <ul className="space-y-1">
                    {product.features.map((feature, index) => (
                      <li key={index} className="flex items-center text-sm text-gray-600">
                        <Check size={14} className="text-green-500 mr-2" />
                        {feature}
                      </li>
                    ))}
                  </ul>
                </div>
                
                <div className="flex gap-3">
                  <button
                    onClick={() => onAddToCart(product)}
                    className="flex-1 bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3 rounded-lg font-bold hover:from-orange-600 hover:to-orange-700 transition-all"
                  >
                    <ShoppingCart size={20} className="inline mr-2" />
                    Add to Cart
                  </button>
                  <div className="flex gap-1">
                    <a
                      href={`mailto:${OTP_CONFIG.EMAIL.SENDER}?subject=Order: ${product.name}&body=I want to order: ${product.name} - à§³${product.price}`}
                      className="px-3 py-3 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition flex items-center justify-center"
                      title="Order via Email"
                    >
                      <Mail size={20} />
                    </a>
                    <a
                      href={`https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}?text=${encodeURIComponent(`I want to order: ${product.name} - à§³${product.price}`)}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="px-3 py-3 border border-green-600 text-green-600 rounded-lg hover:bg-green-50 transition flex items-center justify-center"
                      title="Order via WhatsApp"
                    >
                      <MessageCircle size={20} />
                    </a>
                  </div>
                </div>
              </div>
            </div>
          ));
        })()}
      </div>
      
      <div className="text-center mt-12">
        <div className="flex flex-wrap gap-4 justify-center">
          <a 
            href={`mailto:${OTP_CONFIG.EMAIL.SENDER}`}
            className="inline-flex items-center gap-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-4 rounded-xl font-bold hover:from-blue-600 hover:to-blue-700 transition-all text-lg"
          >
            <Mail size={20} />
            Email Order
          </a>
          <a 
            href={`https://wa.me/${OTP_CONFIG.WHATSAPP.SENDER_NUMBER}`}
            target="_blank"
            rel="noopener noreferrer"
            className="inline-flex items-center gap-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-4 rounded-xl font-bold hover:from-green-600 hover:to-green-700 transition-all text-lg"
          >
            <MessageCircle size={20} />
            WhatsApp Order
          </a>
        </div>
      </div>
    </div>
  </section>
);

// ==================== MAIN APP COMPONENT ====================
const NovaTechApp = () => {
  const [cart, setCart] = useState([]);
  const [showCart, setShowCart] = useState(false);
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [showVisitorForm, setShowVisitorForm] = useState(false);
  const [showDealerApp, setShowDealerApp] = useState(false);
  const [showCheckout, setShowCheckout] = useState(false);
  const [showAdmin, setShowAdmin] = useState(false);
  const [showOrderConfirmation, setShowOrderConfirmation] = useState(false);
  const [currentOrder, setCurrentOrder] = useState(null);
  const [dealerStep, setDealerStep] = useState('login');
  const [userContact, setUserContact] = useState('');
  const [contactMethod, setContactMethod] = useState('');
  const [applicationId, setApplicationId] = useState('');

  // Load cart from localStorage on component mount
  useEffect(() => {
    const savedCart = JSON.parse(localStorage.getItem('nova_cart') || '[]');
    setCart(savedCart);
    
    const hasRegistered = localStorage.getItem('nova_visitor_registered');
    if (!hasRegistered) {
      setTimeout(() => {
        setShowVisitorForm(true);
      }, 2000);
    }
  }, []);

  // Save cart to localStorage whenever it changes
  useEffect(() => {
    localStorage.setItem('nova_cart', JSON.stringify(cart));
  }, [cart]);

  const addToCart = (product) => {
    const existingItem = cart.find(item => item.id === product.id);
    let updatedCart;
    
    if (existingItem) {
      updatedCart = cart.map(item => 
        item.id === product.id 
          ? { ...item, qty: item.qty + 1 }
          : item
      );
    } else {
      updatedCart = [...cart, { ...product, qty: 1 }];
    }
    
    setCart(updatedCart);
    alert(`${product.name} added to cart!`);
  };

  const updateCart = (updatedCart) => {
    setCart(updatedCart);
  };

  const handleOrderSuccess = (orderId, orderData) => {
    setCart([]);
    setCurrentOrder({ orderId, orderData });
    setShowOrderConfirmation(true);
  };

  const handleVisitorSuccess = () => {
    setShowVisitorForm(false);
    alert('Welcome to Nova Tech! Your registration is complete.');
  };

  const handleDealerLogin = () => {
    setShowDealerApp(true);
    setDealerStep('login');
  };

  const handleLoginSubmit = (contactInfo, method) => {
    setUserContact(contactInfo);
    setContactMethod(method);
    setDealerStep('otp');
    
    const otp = generateOTP();
    localStorage.setItem('nova_otp', otp);
    localStorage.setItem('nova_contact', contactInfo);
    localStorage.setItem('nova_contact_method', method);
    localStorage.setItem('otp_expiry', Date.now() + 600000);
    
    alert(`OTP ${otp} has been generated for ${contactInfo} via ${method === 'email' ? 'Email' : 'WhatsApp'}`);
  };

  const handleOTPVerify = (otp) => {
    const storedOTP = localStorage.getItem('nova_otp');
    if (storedOTP === otp) {
      setDealerStep('form');
    } else {
      alert('Invalid OTP. Please try again.');
    }
  };

  const handleApplicationSubmit = (formData, appId) => {
    setApplicationId(appId);
    setDealerStep('success');
  };

  const handleBackToHome = () => {
    setShowDealerApp(false);
    setDealerStep('login');
  };

  // Admin access function
  const checkAdminAccess = () => {
    const storedPassword = localStorage.getItem('nova_admin_password') || DEFAULT_ADMIN_PASSWORD;
    const password = prompt('Enter admin password:');
    if (password === storedPassword) {
      setShowAdmin(true);
    } else {
      alert('Incorrect password!');
    }
  };

  if (showVisitorForm) {
    return (
      <VisitorRegistrationForm 
        onSuccess={handleVisitorSuccess}
        onClose={() => setShowVisitorForm(false)}
      />
    );
  }

  if (showDealerApp) {
    return (
      <div className="font-sans">
        {dealerStep === 'login' && (
          <DealerLogin 
            onLogin={handleLoginSubmit}
            onBack={handleBackToHome}
          />
        )}
        
        {dealerStep === 'otp' && (
          <OTPVerification 
            contactInfo={userContact}
            contactMethod={contactMethod}
            onVerify={handleOTPVerify}
            onBack={() => setDealerStep('login')}
          />
        )}
        
        {dealerStep === 'form' && (
          <DealerApplicationForm 
            contactInfo={userContact}
            contactMethod={contactMethod}
            onSubmit={handleApplicationSubmit}
            onBack={() => setDealerStep('otp')}
          />
        )}
        
        {dealerStep === 'success' && (
          <ApplicationSuccess 
            applicationId={applicationId}
            contactInfo={userContact}
            contactMethod={contactMethod}
            onBack={handleBackToHome}
          />
        )}
      </div>
    );
  }

  if (showCheckout) {
    return (
      <CheckoutForm
        cart={cart}
        onClose={() => setShowCheckout(false)}
        onSuccess={handleOrderSuccess}
      />
    );
  }

  if (showOrderConfirmation && currentOrder) {
    return (
      <OrderConfirmation
        orderId={currentOrder.orderId}
        orderData={currentOrder.orderData}
        onClose={() => {
          setShowOrderConfirmation(false);
          setCurrentOrder(null);
        }}
      />
    );
  }

  if (showAdmin) {
    return (
      <AdminDashboard
        onClose={() => setShowAdmin(false)}
      />
    );
  }

  return (
    <div className="font-sans text-gray-800 min-h-screen bg-gradient-to-b from-white to-gray-50">
      <Header 
        cartCount={cart.reduce((sum, item) => sum + item.qty, 0)}
        onCartClick={() => setShowCart(true)}
        onMenuToggle={() => setIsMenuOpen(!isMenuOpen)}
        isMenuOpen={isMenuOpen}
        onDealerLogin={handleDealerLogin}
        onAdminAccess={checkAdminAccess}
      />
      
      <main>
        <Hero onDealerLogin={handleDealerLogin} />
        <ProductsSection onAddToCart={addToCart} />
        <ContactSection />
      </main>

      <Footer />

      <FloatingActionButtons 
        cart={cart}
        onCartClick={() => setShowCart(true)}
        onDealerLogin={handleDealerLogin}
        onCheckout={() => setShowCheckout(true)}
      />
      
      {showCart && (
        <CartModal
          cart={cart}
          onClose={() => setShowCart(false)}
          onUpdateCart={updateCart}
          onCheckout={() => {
            setShowCart(false);
            setShowCheckout(true);
          }}
        />
      )}
      
      {/* Hidden admin access button */}
      <button
        onClick={checkAdminAccess}
        className="fixed bottom-24 left-6 bg-gray-800 text-white p-3 rounded-full shadow-lg hover:bg-gray-900 transition-all opacity-30 hover:opacity-100"
        title="Admin Access"
      >
        <Settings size={20} />
      </button>
    </div>
  );
};

export default NovaTechApp;
